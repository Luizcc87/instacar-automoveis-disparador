<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerenciador de Campanhas - Instacar Autom√≥veis</title>
    <!-- Supabase JS Library - Vers√£o UMD para expor window.supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      // Garantir que window.supabase est√° dispon√≠vel (fallback para vers√µes que n√£o exp√µem automaticamente)
      if (
        typeof window.supabase === "undefined" &&
        typeof supabase !== "undefined"
      ) {
        window.supabase = supabase;
      }
    </script>
    <!-- Bibliotecas para parsing de planilhas -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <!-- Vari√°veis de ambiente (injetadas em build time via inject-env.js) -->
    <script id="env-config">
      // Vari√°veis de ambiente injetadas em build time
      // Este script √© substitu√≠do pelo inject-env.js durante o build
      // Configure SUPABASE_URL e SUPABASE_ANON_KEY no Cloudflare Pages ou arquivo .env
      window.ENV = {
        SUPABASE_URL: "",
        SUPABASE_ANON_KEY: "",
      };
    </script>
    <!-- Configura√ß√£o opcional (apenas para Uazapi e N8N) -->
    <script src="config.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 30px;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 2em;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
      }

      .config-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
      }

      .config-section h2 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.3em;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        color: #555;
        font-weight: 500;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        font-family: inherit;
      }

      textarea {
        min-height: 100px;
        resize: vertical;
      }

      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: background 0.3s;
      }

      button:hover {
        background: #5568d3;
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .btn-danger {
        background: #dc3545;
      }

      .btn-danger:hover {
        background: #c82333;
      }

      .btn-success {
        background: #28a745;
      }

      .btn-success:hover {
        background: #218838;
      }

      .btn-secondary {
        background: #6c757d;
      }

      .btn-secondary:hover {
        background: #5a6268;
      }

      .campanhas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .campanha-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .campanha-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .campanha-card h3 {
        color: #333;
        margin-bottom: 10px;
        font-size: 1.2em;
      }

      .campanha-card .periodo {
        display: inline-block;
        background: #667eea;
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        margin-bottom: 10px;
      }

      .campanha-card .status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        margin-bottom: 10px;
      }

      .status.ativa {
        background: #d4edda;
        color: #155724;
      }

      .status.pausada {
        background: #fff3cd;
        color: #856404;
      }

      .status.concluida {
        background: #d1ecf1;
        color: #0c5460;
      }

      .campanha-card .descricao {
        color: #666;
        font-size: 14px;
        margin-bottom: 15px;
        min-height: 40px;
      }

      .campanha-card .actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .campanha-card .actions button {
        flex: 1;
        min-width: 80px;
        padding: 8px 16px;
        font-size: 13px;
      }

      .alert {
        padding: 15px 20px;
        border-radius: 6px;
        margin-bottom: 15px;
        font-weight: 500;
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        min-width: 300px;
        max-width: 500px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        animation: slideIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #666;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 12px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-header h2 {
        color: #333;
      }

      .close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #666;
        padding: 0;
        width: 30px;
        height: 30px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .upload-area:hover {
        background: #f8f9ff;
      }

      .upload-area.dragover {
        background: #e8ebff;
        border-color: #5568d3;
      }

      .clientes-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .clientes-table th,
      .clientes-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
      }

      .clientes-table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #333;
        position: sticky;
        top: 0;
      }

      .clientes-table tr:hover {
        background: #f8f9fa;
      }

      .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }

      .badge-valid {
        background: #d4edda;
        color: #155724;
      }

      .badge-invalid {
        background: #f8d7da;
        color: #721c24;
      }

      .badge-unknown {
        background: #fff3cd;
        color: #856404;
      }

      .action-buttons {
        display: flex;
        gap: 5px;
      }

      .action-buttons button {
        padding: 6px 12px;
        font-size: 12px;
      }

      /* Estilos para Modal de Cliente */
      .modal-cliente .modal-content {
        max-width: 900px;
        width: 95%;
      }

      .modal-tabs {
        display: flex;
        gap: 10px;
        border-bottom: 2px solid #e0e0e0;
        margin-bottom: 20px;
      }

      .modal-tab {
        padding: 10px 20px;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        color: #666;
        transition: all 0.3s;
      }

      .modal-tab:hover {
        color: #5568d3;
      }

      .modal-tab.active {
        color: #5568d3;
        border-bottom-color: #5568d3;
      }

      .modal-tab-content {
        display: none;
      }

      .modal-tab-content.active {
        display: block;
      }

      .cliente-field {
        margin-bottom: 15px;
      }

      .cliente-field label {
        display: block;
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
        font-size: 13px;
      }

      .cliente-field .field-value {
        padding: 8px 12px;
        background: #f8f9fa;
        border-radius: 4px;
        min-height: 20px;
        color: #333;
      }

      .cliente-field .field-input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .cliente-field .field-input:focus {
        outline: none;
        border-color: #5568d3;
      }

      .cliente-field.readonly {
        opacity: 0.7;
      }

      .cliente-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .stat-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        text-align: center;
      }

      .stat-card .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #5568d3;
      }

      .stat-card .stat-label {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }

      .observacoes-list {
        max-height: 400px;
        overflow-y: auto;
        margin-bottom: 20px;
      }

      .observacao-item {
        background: #f8f9fa;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 10px;
        border-left: 3px solid #5568d3;
      }

      .observacao-item .observacao-texto {
        color: #333;
        margin-bottom: 8px;
      }

      .observacao-item .observacao-meta {
        font-size: 11px;
        color: #666;
        display: flex;
        justify-content: space-between;
      }

      .observacao-form {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
      }

      .observacao-form textarea {
        width: 100%;
        min-height: 80px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        resize: vertical;
      }

      .historico-envios-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
      }

      .historico-envios-table th,
      .historico-envios-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
      }

      .historico-envios-table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #333;
      }

      .historico-envios-table tr:hover {
        background: #f8f9fa;
      }

      .veiculos-list {
        margin: 15px 0;
      }

      .veiculo-item {
        background: #f8f9fa;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .veiculo-item .veiculo-info {
        flex: 1;
        color: #333;
      }

      .veiculo-item .veiculo-info strong {
        color: #333;
      }

      .veiculo-item .veiculo-actions {
        display: flex;
        gap: 5px;
      }

      .veiculo-form {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin-top: 15px;
      }

      .veiculo-form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 10px;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
        flex-wrap: wrap;
      }

      .btn-danger {
        background: #dc3545;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
      }

      .btn-danger:hover {
        background: #c82333;
      }

      .btn-warning {
        background: #ffc107;
        color: #333;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
      }

      .btn-warning:hover {
        background: #e0a800;
      }

      .modo-edicao .field-value {
        display: none;
      }

      .modo-edicao .field-input {
        display: block;
      }

      .modo-visualizacao .field-value {
        display: block;
      }

      .modo-visualizacao .field-input {
        display: none;
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
        }

        .campanhas-grid {
          grid-template-columns: 1fr;
        }

        .clientes-table {
          font-size: 12px;
        }

        .clientes-table th,
        .clientes-table td {
          padding: 8px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üéØ Gerenciador de Campanhas</h1>
      <p class="subtitle">
        Instacar Autom√≥veis - Sistema de Marketing WhatsApp
      </p>

      <div id="alertContainer"></div>

      <div class="config-section">
        <h2>‚ûï Nova Campanha</h2>
        <button onclick="abrirModalNovaCampanha()">Criar Nova Campanha</button>
      </div>

      <div class="config-section">
        <h2>üìã Campanhas Existentes</h2>
        <div id="campanhasContainer" class="loading">
          <p>Carregando campanhas...</p>
        </div>
      </div>

      <!-- Se√ß√£o Upload de Planilhas -->
      <div class="config-section">
        <h2>üì§ Upload de Planilhas</h2>
        <div id="uploadSection">
          <div
            class="upload-area"
            id="uploadArea"
            style="
              border: 2px dashed #667eea;
              border-radius: 8px;
              padding: 40px;
              text-align: center;
              margin-bottom: 20px;
              cursor: pointer;
              transition: background 0.3s;
            "
          >
            <p style="color: #667eea; font-size: 18px; margin-bottom: 10px">
              üìÅ Arraste arquivos aqui ou clique para selecionar
            </p>
            <p style="color: #666; font-size: 14px">
              Formatos suportados: .xls, .xlsx, .csv, .txt
            </p>
            <input
              type="file"
              id="fileInput"
              accept=".xls,.xlsx,.csv,.txt"
              style="display: none"
              multiple
            />
          </div>

          <div class="form-group">
            <label>Ou cole URL do Google Sheets</label>
            <div style="display: flex; gap: 10px">
              <input
                type="text"
                id="googleSheetsUrl"
                placeholder="https://docs.google.com/spreadsheets/d/..."
                style="flex: 1"
              />
              <button
                type="button"
                onclick="processarGoogleSheets()"
                class="btn-secondary"
              >
                Processar
              </button>
            </div>
          </div>

          <div id="uploadProgress" style="display: none; margin-top: 20px">
            <div
              style="
                background: #f0f0f0;
                border-radius: 4px;
                height: 30px;
                position: relative;
                overflow: hidden;
              "
            >
              <div
                id="progressBar"
                style="
                  background: #667eea;
                  height: 100%;
                  width: 0%;
                  transition: width 0.3s;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  color: white;
                  font-weight: bold;
                "
              >
                0%
              </div>
            </div>
            <p
              id="progressText"
              style="margin-top: 10px; color: #666; text-align: center"
            >
              Processando...
            </p>
          </div>

          <div id="uploadResults" style="margin-top: 20px"></div>
        </div>
      </div>

      <!-- Se√ß√£o Gerenciar Clientes -->
      <div class="config-section">
        <h2>üë• Gerenciar Clientes</h2>
        <div id="clientesSection">
          <div
            style="
              display: flex;
              gap: 10px;
              margin-bottom: 20px;
              flex-wrap: wrap;
            "
          >
            <input
              type="text"
              id="buscaClientes"
              placeholder="Buscar por nome ou telefone..."
              style="flex: 1; min-width: 200px"
              onkeyup="if(event.key === 'Enter') { paginaAtualClientes = 1; carregarListaClientes(1); }"
            />
            <select
              id="filtroStatusWhatsapp"
              style="width: 200px"
              onchange="paginaAtualClientes = 1; carregarListaClientes(1)"
            >
              <option value="">Todos os status</option>
              <option value="valid">WhatsApp V√°lido</option>
              <option value="invalid">WhatsApp Inv√°lido</option>
              <option value="unknown">N√£o Verificado</option>
            </select>
            <label
              style="
                display: flex;
                align-items: center;
                gap: 5px;
                white-space: nowrap;
              "
            >
              Itens por p√°gina:
              <select
                id="itensPorPagina"
                style="width: 80px"
                onchange="paginaAtualClientes = 1; carregarListaClientes(1)"
              >
                <option value="10">10</option>
                <option value="25" selected>25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </label>
            <button
              type="button"
              onclick="carregarListaClientes()"
              class="btn-success"
            >
              üîÑ Atualizar
            </button>
            <button
              type="button"
              onclick="verificarWhatsAppSelecionados()"
              class="btn-secondary"
            >
              ‚úÖ Verificar WhatsApp
            </button>
            <button
              type="button"
              onclick="adicionarNovoCliente()"
              class="btn-success"
            >
              ‚ûï Novo Cliente
            </button>
          </div>

          <div id="clientesContainer" class="loading">
            <p>Carregando clientes...</p>
          </div>

          <div
            id="paginacaoClientes"
            style="
              display: flex;
              justify-content: center;
              gap: 10px;
              margin-top: 20px;
              align-items: center;
            "
          ></div>
        </div>
      </div>

      <!-- Se√ß√£o de Status e Configura√ß√µes (Rodap√©) -->
      <div
        class="config-section"
        style="
          margin-top: 40px;
          border-top: 2px solid #e0e0e0;
          padding-top: 20px;
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
          "
        >
          <h2>üìä Status do Sistema</h2>
          <button
            class="btn-secondary"
            onclick="abrirModalConfiguracoes()"
            style="padding: 8px 16px; font-size: 13px"
          >
            ‚öôÔ∏è Gerenciar Configura√ß√µes
          </button>
        </div>
        <div
          id="statusContainer"
          style="display: flex; gap: 15px; flex-wrap: wrap"
        >
          <div
            id="statusSupabase"
            style="
              flex: 1;
              min-width: 200px;
              padding: 15px;
              border-radius: 8px;
              background: #f8f9fa;
              border: 2px solid #ddd;
            "
          >
            <div
              style="
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 5px;
              "
            >
              <span id="statusSupabaseIcon" style="font-size: 20px">‚è≥</span>
              <strong>Supabase</strong>
            </div>
            <p
              id="statusSupabaseText"
              style="margin: 0; color: #666; font-size: 14px"
            >
              Verificando conex√£o...
            </p>
          </div>
          <div
            id="statusUazapi"
            style="
              flex: 1;
              min-width: 200px;
              padding: 15px;
              border-radius: 8px;
              background: #f8f9fa;
              border: 2px solid #ddd;
            "
          >
            <div
              style="
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 5px;
              "
            >
              <span id="statusUazapiIcon" style="font-size: 20px">‚è≥</span>
              <strong>Uazapi (WhatsApp)</strong>
            </div>
            <p
              id="statusUazapiText"
              style="margin: 0; color: #666; font-size: 14px"
            >
              Verificando configura√ß√£o...
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Configura√ß√µes -->
    <div id="modalConfiguracoes" class="modal">
      <div class="modal-content" style="max-width: 700px">
        <div class="modal-header">
          <h2>‚öôÔ∏è Gerenciar Configura√ß√µes</h2>
          <button class="close" onclick="fecharModalConfiguracoes()">
            &times;
          </button>
        </div>

        <div style="margin-bottom: 20px">
          <h3 style="color: #333; margin-bottom: 15px; font-size: 1.1em">
            Supabase
          </h3>
          <div
            style="
              padding: 15px;
              background: #e7f3ff;
              border-radius: 6px;
              border: 1px solid #b3d9ff;
            "
          >
            <p style="margin: 0; color: #0066cc; font-size: 14px">
              <strong>‚ÑπÔ∏è Configura√ß√£o via Vari√°veis de Ambiente</strong><br />
              As credenciais do Supabase s√£o configuradas via vari√°veis de
              ambiente:
            </p>
            <ul style="margin: 10px 0 0 20px; color: #0066cc; font-size: 13px">
              <li>
                <strong>Dev:</strong> Configure no arquivo <code>.env</code>
              </li>
              <li>
                <strong>Produ√ß√£o (Cloudflare Pages):</strong> Configure em
                Settings > Environment Variables
              </li>
            </ul>
            <p style="margin: 10px 0 0 0; color: #0066cc; font-size: 13px">
              Vari√°veis necess√°rias: <code>SUPABASE_URL</code> e
              <code>SUPABASE_ANON_KEY</code>
            </p>
          </div>
        </div>

        <div
          style="
            margin-bottom: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 15px;
            "
          >
            <h3 style="color: #333; margin: 0; font-size: 1.1em">
              Uazapi (WhatsApp API) - Inst√¢ncias
            </h3>
            <button
              type="button"
              onclick="abrirModalNovaInstanciaUazapi()"
              class="btn-success"
              style="padding: 6px 12px; font-size: 12px"
            >
              ‚ûï Adicionar Inst√¢ncia
            </button>
          </div>

          <div id="instanciasUazapiList" style="margin-bottom: 15px">
            <p style="color: #666; font-style: italic">
              Carregando inst√¢ncias...
            </p>
          </div>
        </div>

        <div
          style="
            margin-bottom: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
          "
        >
          <h3 style="color: #333; margin-bottom: 15px; font-size: 1.1em">
            N8N Webhook
          </h3>
          <div class="form-group">
            <label>URL do Webhook N8N</label>
            <input
              type="text"
              id="configN8nWebhook"
              placeholder="https://seu-n8n.com/webhook/campanha"
            />
            <small style="color: #666; display: block; margin-top: 5px">
              URL do webhook para disparo manual de campanhas (opcional)
            </small>
          </div>
        </div>

        <div
          style="
            margin-bottom: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
          "
        >
          <h3 style="color: #333; margin-bottom: 15px; font-size: 1.1em">
            A√ß√µes
          </h3>
          <div style="display: flex; gap: 10px; flex-wrap: wrap">
            <button
              type="button"
              class="btn-success"
              onclick="salvarConfiguracoes()"
            >
              üíæ Salvar Configura√ß√µes
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="carregarConfiguracoesNoModal()"
            >
              üì• Carregar do LocalStorage
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="exportarConfiguracoes()"
            >
              üì§ Exportar JSON
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="importarConfiguracoes()"
            >
              üì• Importar JSON
            </button>
            <button
              type="button"
              class="btn-danger"
              onclick="limparConfiguracoes()"
            >
              üóëÔ∏è Limpar Tudo
            </button>
          </div>
        </div>

        <div
          style="
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
          "
        >
          <small style="color: #666">
            üí° <strong>Dica:</strong> As configura√ß√µes s√£o salvas no navegador
            (localStorage). Para usar em outro navegador, exporte e importe o
            JSON.
          </small>
        </div>
      </div>
    </div>

    <!-- Modal Nova/Editar Inst√¢ncia Uazapi -->
    <div id="modalInstanciaUazapi" class="modal">
      <div class="modal-content" style="max-width: 600px">
        <div class="modal-header">
          <h2 id="modalInstanciaUazapiTitle">Nova Inst√¢ncia Uazapi</h2>
          <button class="close" onclick="fecharModalInstanciaUazapi()">
            &times;
          </button>
        </div>
        <form id="formInstanciaUazapi">
          <input type="hidden" id="instanciaUazapiId" />

          <div class="form-group">
            <label>Nome da Inst√¢ncia *</label>
            <input
              type="text"
              id="instanciaUazapiNome"
              required
              placeholder="Ex: Uazapi Principal, Z-API Backup, Evolution Teste"
            />
            <small style="color: #666">
              Nome identificador √∫nico para esta inst√¢ncia
            </small>
          </div>

          <div class="form-group">
            <label>Tipo de API *</label>
            <select id="instanciaUazapiTipoApi" required>
              <option value="uazapi">Uazapi</option>
              <option value="zapi">Z-API</option>
              <option value="evolution">Evolution API</option>
              <option value="whatsapp_oficial">WhatsApp Oficial (Meta)</option>
              <option value="outro">Outro</option>
            </select>
            <small style="color: #666">
              Selecione o tipo de API WhatsApp que esta inst√¢ncia utiliza
            </small>
          </div>

          <div class="form-group">
            <label>URL Base da Inst√¢ncia *</label>
            <input
              type="text"
              id="instanciaUazapiBaseUrl"
              required
              placeholder="https://sua-instancia.uazapi.com"
            />
            <small style="color: #666">
              URL base da sua inst√¢ncia (ex: https://fourtakeoff.uazapi.com,
              https://api.z-api.io)
            </small>
          </div>

          <div class="form-group">
            <label>Instance Token *</label>
            <div style="display: flex; gap: 10px">
              <input
                type="password"
                id="instanciaUazapiToken"
                required
                placeholder="Seu instance token da Uazapi"
                style="flex: 1"
              />
              <button
                type="button"
                onclick="togglePasswordVisibility('instanciaUazapiToken')"
                style="padding: 10px 15px; white-space: nowrap"
              >
                üëÅÔ∏è
              </button>
            </div>
            <small style="color: #666">
              ‚ö†Ô∏è Use o Instance Token (n√£o o Admin Token). Endpoints regulares
              usam header "token" com Instance Token.
            </small>
          </div>

          <div class="form-group">
            <label>Descri√ß√£o (Opcional)</label>
            <textarea
              id="instanciaUazapiDescricao"
              rows="3"
              placeholder="Descri√ß√£o opcional desta inst√¢ncia..."
            ></textarea>
          </div>

          <div class="form-group">
            <label>Configura√ß√£o Extra (JSON - Opcional)</label>
            <textarea
              id="instanciaUazapiConfigExtra"
              rows="4"
              placeholder='{"instance_id": "xxx"} ou {"phone_id": "xxx", "business_account_id": "yyy"}'
            ></textarea>
            <small style="color: #666">
              Configura√ß√µes espec√≠ficas da API em formato JSON. Ex: Evolution
              precisa de {"instance_id": "xxx"}, WhatsApp Oficial precisa de
              {"phone_id": "xxx", "business_account_id": "yyy"}
            </small>
          </div>

          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 8px">
              <input
                type="checkbox"
                id="instanciaUazapiAtivo"
                checked
                style="width: auto"
              />
              Inst√¢ncia Ativa
            </label>
            <small style="color: #666">
              Desmarque para desativar esta inst√¢ncia (n√£o aparecer√° nas op√ß√µes
              de campanha)
            </small>
          </div>

          <div style="display: flex; gap: 10px; margin-top: 20px">
            <button type="submit" class="btn-success">
              üíæ Salvar Inst√¢ncia
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="fecharModalInstanciaUazapi()"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Enviar Mensagem Individual -->
    <div id="modalEnviarMensagem" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üì§ Enviar Mensagem Individual</h2>
          <button class="close" onclick="fecharModalEnviarMensagem()">
            &times;
          </button>
        </div>
        <form id="formEnviarMensagem">
          <input type="hidden" id="enviarMensagemClienteId" />
          <input type="hidden" id="enviarMensagemTelefone" />

          <div class="form-group">
            <label>Cliente</label>
            <input
              type="text"
              id="enviarMensagemClienteNome"
              readonly
              style="background: #f5f5f5"
            />
          </div>

          <div class="form-group">
            <label>Telefone</label>
            <input
              type="text"
              id="enviarMensagemClienteTelefone"
              readonly
              style="background: #f5f5f5"
            />
          </div>

          <div class="form-group">
            <label>Tipo de Envio *</label>
            <select id="tipoEnvio" required onchange="toggleTipoEnvio()">
              <option value="">Selecione...</option>
              <option value="campanha">Usar Campanha Existente</option>
              <option value="customizada">Mensagem Customizada</option>
            </select>
          </div>

          <div
            class="form-group"
            id="campanhaSelectGroup"
            style="display: none"
          >
            <label>Selecionar Campanha *</label>
            <select id="campanhaSelecionada">
              <option value="">Carregando campanhas...</option>
            </select>
          </div>

          <div
            class="form-group"
            id="mensagemCustomizadaGroup"
            style="display: none"
          >
            <label>Mensagem Customizada *</label>
            <textarea
              id="mensagemCustomizada"
              rows="6"
              placeholder="Digite a mensagem personalizada aqui..."
            ></textarea>
          </div>

          <div style="display: flex; gap: 10px; margin-top: 20px">
            <button type="submit" class="btn-success">
              üì§ Enviar Mensagem
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="fecharModalEnviarMensagem()"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Nova/Editar Campanha -->
    <div id="modalCampanha" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalTitle">Nova Campanha</h2>
          <button class="close" onclick="fecharModal()">&times;</button>
        </div>
        <form id="formCampanha">
          <input type="hidden" id="campanhaId" />

          <div class="form-group">
            <label>Nome da Campanha *</label>
            <input type="text" id="nome" required />
          </div>

          <div class="form-group">
            <label>Descri√ß√£o</label>
            <textarea id="descricao"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Per√≠odo do Ano *</label>
              <select id="periodo_ano" required>
                <option value="">Selecione...</option>
                <option value="janeiro">Janeiro</option>
                <option value="fevereiro">Fevereiro</option>
                <option value="marco">Mar√ßo</option>
                <option value="abril">Abril</option>
                <option value="maio">Maio</option>
                <option value="junho">Junho</option>
                <option value="julho">Julho</option>
                <option value="agosto">Agosto</option>
                <option value="setembro">Setembro</option>
                <option value="outubro">Outubro</option>
                <option value="novembro">Novembro</option>
                <option value="dezembro">Dezembro</option>
                <option value="black-friday">Black Friday</option>
                <option value="dia-maes">Dia das M√£es</option>
                <option value="dia-pais">Dia dos Pais</option>
                <option value="natal">Natal</option>
                <option value="ano-novo">Ano Novo</option>
              </select>
            </div>

            <div class="form-group">
              <label>Status *</label>
              <select id="status" required>
                <option value="ativa">Ativa</option>
                <option value="pausada">Pausada</option>
                <option value="concluida">Conclu√≠da</option>
                <option value="cancelada">Cancelada</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Data In√≠cio</label>
              <input type="date" id="data_inicio" />
            </div>

            <div class="form-group">
              <label>Data Fim</label>
              <input type="date" id="data_fim" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Limite de Envios/Dia</label>
              <input type="number" id="limite_envios_dia" value="200" min="1" />
            </div>

            <div class="form-group">
              <label>Intervalo M√≠nimo (dias)</label>
              <input
                type="number"
                id="intervalo_minimo_dias"
                value="30"
                min="1"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Intervalo Entre Envios (segundos) - Opcional</label>
              <input
                type="number"
                id="intervalo_envios_segundos"
                min="60"
                max="300"
                placeholder="130-150 (padr√£o aleatorizado)"
              />
              <small style="color: #666">
                Deixe vazio para usar padr√£o (130-150s aleatorizado). Configure
                valor fixo para controle preciso.
              </small>
            </div>

            <div class="form-group">
              <label>Prioridade (1-10)</label>
              <input type="number" id="prioridade" value="5" min="1" max="10" />
              <small style="color: #666">
                Maior prioridade processada primeiro quando cliente eleg√≠vel
                para m√∫ltiplas campanhas
              </small>
            </div>
          </div>

          <div class="form-group">
            <label>Inst√¢ncia API WhatsApp *</label>
            <select id="whatsapp_api_id" required>
              <option value="">Carregando inst√¢ncias...</option>
            </select>
            <small style="color: #666">
              Selecione qual inst√¢ncia de API WhatsApp usar para esta campanha.
              Configure inst√¢ncias em "‚öôÔ∏è Gerenciar Configura√ß√µes".
            </small>
          </div>

          <!-- Se√ß√£o de Estimativas de Tempo -->
          <div
            id="estimativas-tempo"
            style="
              background: #f5f5f5;
              padding: 15px;
              border-radius: 5px;
              margin-top: 15px;
              margin-bottom: 15px;
            "
          >
            <h4 style="margin-top: 0; color: #333">üìä Estimativas de Tempo</h4>
            <div id="estimativas-conteudo">
              <p style="color: #666; font-size: 14px">
                Configure o limite di√°rio e intervalo para ver estimativas
              </p>
            </div>
          </div>

          <div class="form-group">
            <label>Agendamento Cron (opcional)</label>
            <input
              type="text"
              id="agendamento_cron"
              placeholder="0 9 * * 1-5 (9h, dias √∫teis)"
            />
            <small style="color: #666"
              >Formato: minuto hora dia m√™s dia-semana</small
            >
          </div>

          <div class="form-group">
            <label>Prompt Personalizado para IA *</label>
            <textarea
              id="prompt_ia"
              required
              placeholder="Instru√ß√µes espec√≠ficas para a IA gerar mensagens desta campanha..."
            ></textarea>
          </div>

          <div class="form-group">
            <label>Template de Mensagem (opcional)</label>
            <textarea
              id="template_mensagem"
              placeholder="Template base opcional..."
            ></textarea>
          </div>

          <!-- Se√ß√£o: Configura√ß√µes de IA -->
          <div
            style="
              background: #f0f7ff;
              padding: 15px;
              border-radius: 6px;
              margin-top: 20px;
              margin-bottom: 20px;
              border-left: 4px solid #667eea;
            "
          >
            <h4 style="margin-top: 0; color: #333; margin-bottom: 15px">
              ü§ñ Configura√ß√µes do Agente IA
            </h4>

            <div class="form-group" style="margin-bottom: 15px">
              <label
                style="display: flex; align-items: center; cursor: pointer"
              >
                <input
                  type="checkbox"
                  id="usar_veiculos"
                  checked
                  style="width: auto; margin-right: 8px"
                />
                <span>Incluir informa√ß√µes de ve√≠culos no contexto da IA</span>
              </label>
              <small style="color: #666; display: block; margin-top: 5px">
                Se marcado, a IA ter√° acesso aos dados de ve√≠culos do cliente.
                Desmarque para campanhas gen√©ricas (Natal, Ano Novo).
              </small>
            </div>

            <div class="form-group" style="margin-bottom: 15px">
              <label
                style="display: flex; align-items: center; cursor: pointer"
              >
                <input
                  type="checkbox"
                  id="usar_vendedor"
                  style="width: auto; margin-right: 8px"
                />
                <span>Incluir nome do vendedor no contexto da IA</span>
              </label>
              <small style="color: #666; display: block; margin-top: 5px">
                Se marcado, a IA poder√° mencionar o vendedor do ve√≠culo mais
                recente. √ötil para campanhas de relacionamento.
              </small>
            </div>
          </div>

          <!-- Se√ß√£o: Processamento em Lotes -->
          <div
            style="
              background: #fff5f0;
              padding: 15px;
              border-radius: 6px;
              margin-top: 20px;
              margin-bottom: 20px;
              border-left: 4px solid #ff6b35;
            "
          >
            <h4 style="margin-top: 0; color: #333; margin-bottom: 15px">
              ‚öôÔ∏è Processamento em Lotes e Hor√°rio
            </h4>

            <div class="form-row">
              <div class="form-group">
                <label>Tamanho do Lote</label>
                <input
                  type="number"
                  id="tamanho_lote"
                  value="50"
                  min="10"
                  max="500"
                />
                <small style="color: #666">
                  N√∫mero de clientes processados por execu√ß√£o (padr√£o: 50,
                  m√≠nimo: 10, m√°ximo: 500)
                </small>
              </div>

              <div class="form-group">
                <label>Processar Finais de Semana</label>
                <div style="margin-top: 8px">
                  <label
                    style="display: flex; align-items: center; cursor: pointer"
                  >
                    <input
                      type="checkbox"
                      id="processar_finais_semana"
                      style="width: auto; margin-right: 8px"
                    />
                    <span>Processar tamb√©m s√°bados e domingos</span>
                  </label>
                </div>
                <small style="color: #666">
                  Se desmarcado, processa apenas dias √∫teis (segunda a sexta)
                </small>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Hor√°rio In√≠cio</label>
                <input type="time" id="horario_inicio" value="09:00" />
                <small style="color: #666">
                  Hor√°rio de in√≠cio para processamento (formato HH:MM)
                </small>
              </div>

              <div class="form-group">
                <label>Hor√°rio Fim</label>
                <input type="time" id="horario_fim" value="18:00" />
                <small style="color: #666">
                  Hor√°rio de fim para processamento (formato HH:MM)
                </small>
              </div>
            </div>

            <div
              id="estimativas-lote"
              style="
                background: #f5f5f5;
                padding: 10px;
                border-radius: 4px;
                margin-top: 10px;
              "
            >
              <p style="color: #666; font-size: 13px; margin: 0">
                <strong>Estimativa:</strong>
                <span id="estimativa-dias-lote"
                  >Configure o tamanho do lote e limite di√°rio para ver
                  estimativa</span
                >
              </p>
            </div>
          </div>

          <div style="display: flex; gap: 10px; margin-top: 20px">
            <button type="submit" class="btn-success">Salvar</button>
            <button type="button" class="btn-secondary" onclick="fecharModal()">
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Detalhes do Cliente -->
    <div id="modalCliente" class="modal modal-cliente">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalClienteTitle">Detalhes do Cliente</h2>
          <button class="close" onclick="fecharModalCliente()">&times;</button>
        </div>
        <div id="modalClienteLoading" style="text-align: center; padding: 40px">
          <p>Carregando dados do cliente...</p>
        </div>
        <div id="modalClienteContent" style="display: none">
          <input type="hidden" id="clienteId" />

          <div class="modal-tabs">
            <button
              class="modal-tab active"
              onclick="trocarTabCliente('dados')"
            >
              üìã Dados
            </button>
            <button class="modal-tab" onclick="trocarTabCliente('observacoes')">
              üìù Observa√ß√µes
            </button>
            <button class="modal-tab" onclick="trocarTabCliente('historico')">
              üì® Hist√≥rico
            </button>
          </div>

          <!-- Tab Dados -->
          <div id="tabDados" class="modal-tab-content active">
            <div style="display: flex; gap: 10px; margin-bottom: 20px">
              <button
                id="btnEditarCliente"
                class="btn-secondary"
                onclick="alternarModoEdicao()"
              >
                ‚úèÔ∏è Editar
              </button>
              <button
                id="btnSalvarCliente"
                class="btn-success"
                onclick="salvarEdicaoCliente()"
                style="display: none"
              >
                üíæ Salvar
              </button>
              <button
                id="btnCancelarEdicao"
                class="btn-secondary"
                onclick="cancelarEdicao()"
                style="display: none"
              >
                ‚ùå Cancelar
              </button>
            </div>

            <div class="cliente-field">
              <label>Nome do Cliente *</label>
              <div class="field-value" id="fieldNomeValue"></div>
              <input
                type="text"
                class="field-input"
                id="fieldNomeInput"
                required
              />
            </div>

            <div class="cliente-field">
              <label>Telefone *</label>
              <div class="field-value" id="fieldTelefoneValue"></div>
              <input
                type="text"
                class="field-input"
                id="fieldTelefoneInput"
                required
              />
            </div>

            <div class="cliente-field">
              <label>Email</label>
              <div class="field-value" id="fieldEmailValue"></div>
              <input type="email" class="field-input" id="fieldEmailInput" />
            </div>

            <div class="cliente-field readonly">
              <label>Status WhatsApp</label>
              <div class="field-value" id="fieldStatusWhatsappValue"></div>
              <button
                class="btn-secondary"
                onclick="verificarWhatsAppDoModal()"
                style="margin-top: 5px"
              >
                ‚úÖ Verificar WhatsApp
              </button>
            </div>

            <div class="cliente-stats">
              <div class="stat-card">
                <div class="stat-value" id="statTotalEnvios">0</div>
                <div class="stat-label">Total de Envios</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statPrimeiroEnvio">-</div>
                <div class="stat-label">Primeiro Envio</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statUltimoEnvio">-</div>
                <div class="stat-label">√öltimo Envio</div>
              </div>
            </div>

            <div class="cliente-field">
              <label>Ve√≠culos</label>
              <div id="veiculosList" class="veiculos-list"></div>
              <div id="veiculoForm" class="veiculo-form" style="display: none">
                <div class="veiculo-form-row">
                  <input
                    type="text"
                    id="veiculoMarca"
                    placeholder="Marca"
                    class="field-input"
                  />
                  <input
                    type="text"
                    id="veiculoModelo"
                    placeholder="Modelo"
                    class="field-input"
                  />
                </div>
                <div class="veiculo-form-row">
                  <input
                    type="text"
                    id="veiculoAno"
                    placeholder="Ano"
                    class="field-input"
                  />
                  <input
                    type="text"
                    id="veiculoPlaca"
                    placeholder="Placa"
                    class="field-input"
                  />
                </div>
                <div style="display: flex; gap: 10px">
                  <button
                    class="btn-success"
                    onclick="adicionarVeiculoCliente()"
                  >
                    ‚ûï Adicionar
                  </button>
                  <button
                    class="btn-secondary"
                    onclick="cancelarAdicionarVeiculo()"
                  >
                    Cancelar
                  </button>
                </div>
              </div>
              <button
                class="btn-secondary"
                onclick="mostrarFormVeiculo()"
                id="btnMostrarFormVeiculo"
              >
                ‚ûï Adicionar Ve√≠culo
              </button>
            </div>

            <div class="cliente-field readonly">
              <label>Data de Cria√ß√£o</label>
              <div class="field-value" id="fieldCreatedAt"></div>
            </div>

            <div class="cliente-field readonly">
              <label>√öltima Atualiza√ß√£o</label>
              <div class="field-value" id="fieldUpdatedAt"></div>
            </div>
          </div>

          <!-- Tab Observa√ß√µes -->
          <div id="tabObservacoes" class="modal-tab-content">
            <div class="observacoes-list" id="observacoesList">
              <p style="text-align: center; color: #666; padding: 20px">
                Nenhuma observa√ß√£o registrada.
              </p>
            </div>
            <div class="observacao-form">
              <label
                style="font-weight: 600; margin-bottom: 8px; display: block"
                >Nova Observa√ß√£o</label
              >
              <textarea
                id="novaObservacaoTexto"
                placeholder="Digite uma observa√ß√£o sobre o cliente..."
              ></textarea>
              <button
                class="btn-success"
                onclick="adicionarObservacaoCliente()"
                style="margin-top: 10px"
              >
                ‚ûï Adicionar Observa√ß√£o
              </button>
            </div>
          </div>

          <!-- Tab Hist√≥rico -->
          <div id="tabHistorico" class="modal-tab-content">
            <div style="margin-bottom: 15px">
              <label style="font-weight: 600; margin-right: 10px"
                >Filtros:</label
              >
              <select
                id="filtroStatusHistorico"
                onchange="filtrarHistorico()"
                style="padding: 5px; margin-right: 10px"
              >
                <option value="">Todos os status</option>
                <option value="enviado">Enviado</option>
                <option value="erro">Erro</option>
                <option value="bloqueado">Bloqueado</option>
              </select>
              <input
                type="date"
                id="filtroDataHistorico"
                onchange="filtrarHistorico()"
                style="padding: 5px"
              />
            </div>
            <div style="overflow-x: auto; max-height: 500px; overflow-y: auto">
              <table class="historico-envios-table">
                <thead>
                  <tr>
                    <th>Data/Hora</th>
                    <th>Status</th>
                    <th>Campanha</th>
                    <th>Mensagem</th>
                  </tr>
                </thead>
                <tbody id="historicoEnviosBody">
                  <tr>
                    <td
                      colspan="4"
                      style="text-align: center; padding: 20px; color: #666"
                    >
                      Carregando hist√≥rico...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="modal-actions">
            <button
              class="btn-warning"
              onclick="desativarCliente(document.getElementById('clienteId').value)"
              id="btnDesativarCliente"
            >
              üö´ Desativar Cliente
            </button>
            <button
              class="btn-danger"
              onclick="excluirCliente(document.getElementById('clienteId').value)"
              id="btnExcluirCliente"
            >
              üóëÔ∏è Excluir Cliente
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="app.js"></script>
  </body>
</html>
