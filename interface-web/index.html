<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerenciador de Campanhas - Instacar Autom√≥veis</title>
    <!-- Google Fonts - Inter e Plus Jakarta Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Supabase JS Library - Vers√£o UMD para expor window.supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      // Garantir que window.supabase est√° dispon√≠vel (fallback para vers√µes que n√£o exp√µem automaticamente)
      if (
        typeof window.supabase === "undefined" &&
        typeof supabase !== "undefined"
      ) {
        window.supabase = supabase;
      }
    </script>
    <!-- Bibliotecas para parsing de planilhas -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <!-- Chart.js para gr√°ficos do dashboard -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Vari√°veis de ambiente (injetadas em build time via inject-env.js) -->
    <!-- ‚ö†Ô∏è NUNCA commite este arquivo ap√≥s executar inject-env.js com credenciais reais -->
    <script id="env-config">
      // Vari√°veis de ambiente injetadas em build time
      window.ENV = {
        SUPABASE_URL: "https://rirrnhelyutzunwicmkg.supabase.co",
        SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpcnJuaGVseXV0enVud2ljbWtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3OTIyMzAsImV4cCI6MjA2ODM2ODIzMH0.L2nJDqybzrl8sC4g5Oo9B92yfx2xfGAoTnZihCPtwg0"
      };
    </script>
    <!-- Configura√ß√£o opcional (apenas para Uazapi e N8N) -->
    <!-- 
      NOTA: config.default.js √© sempre carregado (versionado).
      Para desenvolvimento local, voc√™ pode criar um config.js que ser√° carregado
      automaticamente pelo servidor local, mas n√£o √© necess√°rio no deploy.
    -->
    <script src="config.default.js"></script>
    <!-- Novos arquivos CSS -->
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="components.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* Estilos antigos mantidos para compatibilidade */
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
      }

      /* Container antigo - mantido para compatibilidade com conte√∫do existente */
      .container {
        max-width: 100%;
        margin: 0;
        background: transparent;
        border-radius: 0;
        box-shadow: none;
        padding: 0;
      }

      h1 {
        color: #111827;
        margin-bottom: 12px;
        font-size: 2rem;
        font-weight: 700;
        letter-spacing: -0.02em;
        line-height: 1.2;
      }

      .subtitle {
        color: #6b7280;
        margin-bottom: 32px;
        font-size: 0.9375rem;
        line-height: 1.5;
      }

      .config-section {
        background: var(--bg-primary);
        padding: 28px;
        border-radius: var(--radius-xl);
        margin-bottom: 32px;
        border: 1px solid var(--border-color);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
        transition: all var(--transition-base);
      }
      
      .config-section:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .config-section h2 {
        color: #111827;
        margin-bottom: 20px;
        font-size: 1.25rem;
        font-weight: 600;
        letter-spacing: -0.01em;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-section {
        margin-bottom: 2rem;
        padding: 1.5rem;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        background: #fafafa;
      }

      .form-section h3 {
        margin-top: 0;
        margin-bottom: 1rem;
        color: #333;
        font-size: 1.1rem;
      }

      .help-text {
        font-size: 0.85rem;
        color: #666;
        margin-top: 0.25rem;
        margin-bottom: 0;
      }

      .validation-message {
        font-size: 0.85rem;
        margin-top: 0.5rem;
        padding: 0.5rem;
        border-radius: 4px;
      }

      .validation-message.error {
        background: #fee;
        color: #c00;
        border: 1px solid #fcc;
      }

      .validation-message.success {
        background: #efe;
        color: #060;
        border: 1px solid #cfc;
      }

      .validation-message.warning {
        background: #ffc;
        color: #660;
        border: 1px solid #fec;
      }

      label {
        display: block;
        margin-bottom: 8px;
        color: #374151;
        font-weight: 500;
        font-size: 0.875rem;
        line-height: 1.5;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 0.875rem;
        font-family: inherit;
        background: white;
        color: #111827;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      input:hover,
      textarea:hover,
      select:hover {
        border-color: #9ca3af;
      }

      textarea {
        min-height: 100px;
        resize: vertical;
        line-height: 1.5;
      }

      /* Estilos para op√ß√µes pr√©-definidas de intervalo */
      .intervalo-preset-option {
        display: flex;
        align-items: center;
        cursor: pointer;
        padding: 8px;
        border-radius: 4px;
        transition: background 0.2s;
        margin-bottom: 0;
        border: 1px solid transparent;
      }

      .intervalo-preset-option input[type="radio"] {
        width: auto;
        margin-right: 8px;
        cursor: pointer;
        margin: 0 8px 0 0;
      }

      .intervalo-preset-option span {
        flex: 1;
      }

      .intervalo-preset-option:hover {
        background: #f3f4f6;
      }

      .intervalo-preset-option input[type="radio"]:checked + span {
        font-weight: 600;
      }

      .intervalo-preset-option:has(input[type="radio"]:checked),
      .intervalo-preset-option.selected {
        background: #e0e7ff;
        border-color: #667eea;
      }

      .intervalo-preset-option:has(input[type="radio"]:checked):hover,
      .intervalo-preset-option.selected:hover {
        background: #d1d5f9;
      }

      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        position: relative;
        overflow: hidden;
      }

      button:hover:not(:disabled) {
        background: #5568d3;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }

      button:active:not(:disabled) {
        transform: translateY(0);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      }

      button:disabled {
        background: #d1d5db;
        color: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn-danger {
        background: #dc3545;
      }

      .btn-danger:hover:not(:disabled) {
        background: #c82333;
      }

      .btn-success {
        background: #28a745;
      }

      .btn-success:hover:not(:disabled) {
        background: #218838;
      }

      .btn-secondary {
        background: #6c757d;
      }

      .btn-secondary:hover:not(:disabled) {
        background: #5a6268;
      }

      .campanhas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .campanhas-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 20px;
      }

      .campanha-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .campanha-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        border-color: #d1d5db;
      }

      /* Estilos para visualiza√ß√£o em lista - Baseado no layout de inst√¢ncias Uazapi */
      .campanhas-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .campanhas-list .campanha-card {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        flex-wrap: wrap;
        gap: 10px;
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        background: #f9fafb;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        min-height: auto;
      }

      /* Hover state melhorado */
      .campanhas-list .campanha-card:hover {
        background: #ffffff;
        border-color: #9ca3af;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      /* Container de informa√ß√µes (lado esquerdo) */
      .campanhas-list .campanha-card .campanha-info {
        flex: 1 1 0;
        min-width: 200px;
      }

      .campanhas-list .campanha-card .campanha-info h3 {
        margin: 0 0 8px 0;
        font-size: 1rem;
        color: #111827;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
      }

      .campanhas-list .campanha-card .campanha-info .badges {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 5px;
        flex-wrap: wrap;
      }

      .campanhas-list .campanha-card .campanha-info .descricao {
        color: #6b7280;
        font-size: 0.75rem;
        line-height: 1.4;
        margin: 4px 0 0 0;
      }

      .campanhas-list .campanha-card .campanha-info .meta-info {
        color: #6b7280;
        font-size: 0.75rem;
        margin-top: 4px;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      .campanhas-list .campanha-card .campanha-info .meta-info span {
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      /* Container de a√ß√µes (lado direito) */
      .campanhas-list .campanha-card .actions {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
        flex-shrink: 0;
        align-items: center;
        justify-content: flex-end;
      }

      /* Badges de status inline (como nas inst√¢ncias) */
      .campanhas-list .campanha-card .status-badge-inline {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 500;
      }

      .campanhas-list
        .campanha-card
        .campanha-status
        .status-consolidado
        .status-icon {
        font-size: 16px;
        line-height: 1;
      }

      .campanhas-list
        .campanha-card
        .campanha-status
        .status-consolidado
        .status-text {
        font-size: 13px;
        font-weight: 600;
      }

      /* Ajustes para background baseado em status */
      .campanhas-list .campanha-card {
        background: #f9fafb;
      }

      .campanhas-list .campanha-card:hover {
        background: #ffffff;
      }

      /* Bot√µes estilo inst√¢ncias Uazapi */
      .campanhas-list .campanha-card .actions button {
        padding: 6px 12px;
        font-size: 12px;
        font-weight: 500;
        white-space: nowrap;
        transition: all 0.2s ease;
        border-radius: 6px;
        cursor: pointer;
        border: 1px solid transparent;
      }

      /* A√ß√£o prim√°ria (Disparar) com destaque visual melhorado */
      .campanhas-list
        .campanha-card
        .actions
        button.btn-success:not(:disabled) {
        background: #28a745;
        color: white;
        border-color: #28a745;
      }

      .campanhas-list
        .campanha-card
        .actions
        button.btn-success:not(:disabled):hover {
        background: #218838;
        border-color: #218838;
      }

      /* Bot√µes desabilitados com feedback visual claro */
      .campanhas-list .campanha-card .actions button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .campanhas-list .campanha-card .actions button:first-child {
        margin-top: 0;
      }

      /* Efeito de ripple nos bot√µes (opcional, moderno) */
      .campanhas-list .campanha-card .actions button::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.3s, height 0.3s;
      }

      .campanhas-list .campanha-card .actions button:active::before {
        width: 300px;
        height: 300px;
      }

      /* Controle de visualiza√ß√£o */
      .view-toggle {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        padding: 10px;
        background: white;
        border-radius: 6px;
        border: 1px solid #e0e0e0;
      }

      .view-toggle-label {
        font-size: 14px;
        color: #666;
        font-weight: 500;
      }

      .view-toggle-buttons {
        display: flex;
        gap: 5px;
        background: #f0f0f0;
        border-radius: 6px;
        padding: 3px;
      }

      .view-toggle-btn {
        background: transparent;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.2s;
        color: #666;
      }

      .view-toggle-btn:hover {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
      }

      .view-toggle-btn.active {
        background: #667eea;
        color: white;
        box-shadow: 0 1px 2px rgba(102, 126, 234, 0.2);
      }

      .campanha-card h3 {
        color: #111827;
        margin-bottom: 12px;
        font-size: 1.125rem;
        font-weight: 600;
        letter-spacing: -0.01em;
        line-height: 1.4;
      }

      .campanha-card .periodo {
        display: inline-flex;
        align-items: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 6px 14px;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
        letter-spacing: 0.025em;
        margin-bottom: 0;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        transition: all 0.2s ease;
      }

      .campanha-card .periodo:hover {
        transform: scale(1.05);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
      }

      .campanha-card .status {
        display: inline-flex;
        align-items: center;
        padding: 6px 14px;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-bottom: 10px;
        border: 1px solid transparent;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
      }

      .status.ativa {
        background: #d4edda;
        color: #155724;
      }

      .status.pausada {
        background: #fff3cd;
        color: #856404;
      }

      .status.concluida {
        background: #d1ecf1;
        color: #0c5460;
      }

      .campanha-card .descricao {
        color: #6b7280;
        font-size: 0.875rem;
        line-height: 1.5;
        margin-bottom: 16px;
        min-height: 40px;
      }

      .campanha-card .actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .campanha-card .actions button {
        flex: 1;
        min-width: 80px;
        padding: 8px 16px;
        font-size: 13px;
      }

      .alert {
        padding: 16px 20px;
        border-radius: 12px;
        margin-bottom: 15px;
        font-weight: 500;
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        min-width: 300px;
        max-width: 500px;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid transparent;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .alert-success {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: #065f46;
        border-color: #6ee7b7;
      }

      .alert-error {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        color: #991b1b;
        border-color: #fca5a5;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #666;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        padding: 32px;
        border-radius: 16px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid #e5e7eb;
      }

      .modal-header h2 {
        color: #111827;
        font-size: 1.5rem;
        font-weight: 600;
        letter-spacing: -0.01em;
      }

      .close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #6b7280;
        padding: 4px;
        width: 32px;
        height: 32px;
        border-radius: 6px;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .close:hover {
        background: #f3f4f6;
        color: #111827;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .upload-area:hover {
        background: #f8f9ff;
      }

      .upload-area.dragover {
        background: #e8ebff;
        border-color: #5568d3;
      }

      .clientes-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        border-radius: 12px;
        overflow: visible;
        border: 1px solid #e5e7eb;
      }

      .clientes-table th,
      .clientes-table td {
        padding: 14px 16px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
      }

      .clientes-table th {
        background: #f9fafb;
        font-weight: 600;
        color: #111827;
        position: sticky;
        top: 0;
        font-size: 0.8125rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .clientes-table tr:hover {
        background: #f9fafb;
      }

      .clientes-table tr:last-child td {
        border-bottom: none;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        padding: 6px 14px;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        border: 1px solid transparent;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      }

      .badge-valid {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: #065f46;
        border-color: #6ee7b7;
      }

      .badge-invalid {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        color: #991b1b;
        border-color: #fca5a5;
      }

      .badge-unknown {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        color: #92400e;
        border-color: #fcd34d;
      }

      .action-buttons {
        display: flex;
        gap: 5px;
      }

      .action-buttons button {
        padding: 6px 12px;
        font-size: 12px;
      }

      /* Estilos para Modal de Cliente */
      .modal-cliente .modal-content {
        max-width: 900px;
        width: 95%;
      }

      .modal-tabs {
        display: flex;
        gap: 8px;
        border-bottom: 2px solid #e5e7eb;
        margin-bottom: 24px;
      }

      .modal-tab {
        padding: 12px 20px;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        color: #6b7280;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 8px 8px 0 0;
      }

      .modal-tab:hover {
        color: #667eea;
        background: #f9fafb;
      }

      .modal-tab.active {
        color: hsl(var(--primary));
        border-bottom-color: hsl(var(--primary));
        background: hsl(var(--muted) / 0.3);
      }

      .modal-tab-content {
        display: none;
      }

      .modal-tab-content.active {
        display: block;
      }

      /* Modo visualiza√ß√£o e edi√ß√£o */
      /* Por padr√£o, modo visualiza√ß√£o est√° ativo */
      #modalClienteContent.modo-visualizacao .modo-visualizacao {
        display: block !important;
      }

      #modalClienteContent.modo-visualizacao .modo-edicao {
        display: none !important;
      }

      /* Quando em modo edi√ß√£o, inverter */
      #modalClienteContent.modo-edicao .modo-visualizacao {
        display: none !important;
      }

      #modalClienteContent.modo-edicao .modo-edicao {
        display: block !important;
      }

      /* Garantir que inputs e checkboxes sejam exibidos corretamente no modo edi√ß√£o */
      #modalClienteContent.modo-edicao .form-input.modo-edicao,
      #modalClienteContent.modo-edicao .form-checkbox.modo-edicao {
        display: block !important;
      }

      #modalClienteContent.modo-visualizacao .form-input.modo-edicao,
      #modalClienteContent.modo-visualizacao .form-checkbox.modo-edicao {
        display: none !important;
      }

      .modal-tab-content {
        display: none;
      }

      .modal-tab-content.active {
        display: block;
      }

      .cliente-field {
        margin-bottom: 15px;
      }

      .cliente-field label {
        display: block;
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
        font-size: 13px;
      }

      .cliente-field .field-value {
        padding: 10px 14px;
        background: #f9fafb;
        border-radius: 8px;
        min-height: 24px;
        color: #111827;
        border: 1px solid #e5e7eb;
      }

      .cliente-field .field-input {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 0.875rem;
        background: white;
        color: #111827;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .cliente-field .field-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .cliente-field .field-input:hover {
        border-color: #9ca3af;
      }

      .cliente-field.readonly {
        opacity: 0.7;
      }

      .cliente-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        border: 1px solid #e5e7eb;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
      }

      .stat-card:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transform: translateY(-1px);
      }

      .stat-card .stat-value {
        font-size: 1.875rem;
        font-weight: 700;
        color: #667eea;
        line-height: 1.2;
      }

      .stat-card .stat-label {
        font-size: 0.75rem;
        color: #6b7280;
        margin-top: 8px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .observacoes-list {
        max-height: 400px;
        overflow-y: auto;
        margin-bottom: 20px;
      }

      .observacao-item {
        background: white;
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 12px;
        border-left: 4px solid #667eea;
        border: 1px solid #e5e7eb;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
      }

      .observacao-item:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      .observacao-item .observacao-texto {
        color: #333;
        margin-bottom: 8px;
      }

      .observacao-item .observacao-meta {
        font-size: 11px;
        color: #666;
        display: flex;
        justify-content: space-between;
      }

      .observacao-form {
        background: #f9fafb;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
      }

      .observacao-form textarea {
        width: 100%;
        min-height: 80px;
        padding: 10px 14px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 0.875rem;
        resize: vertical;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .observacao-form textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .historico-envios-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8125rem;
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid #e5e7eb;
      }

      .historico-envios-table th,
      .historico-envios-table td {
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
      }

      .historico-envios-table th {
        background: #f9fafb;
        font-weight: 600;
        color: #111827;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .historico-envios-table tr:hover {
        background: #f9fafb;
      }

      .historico-envios-table tr:last-child td {
        border-bottom: none;
      }

      .veiculos-list {
        margin: 15px 0;
      }

      .veiculo-item {
        background: white;
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid #e5e7eb;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
      }

      .veiculo-item:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transform: translateY(-1px);
      }

      .veiculo-item .veiculo-info {
        flex: 1;
        color: #333;
      }

      .veiculo-item .veiculo-info strong {
        color: #333;
      }

      .veiculo-item .veiculo-actions {
        display: flex;
        gap: 5px;
      }

      .veiculo-form {
        background: #f9fafb;
        padding: 20px;
        border-radius: 12px;
        margin-top: 16px;
        border: 1px solid #e5e7eb;
      }

      .veiculo-form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 10px;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
        flex-wrap: wrap;
      }

      .btn-danger {
        background: #dc3545;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      }

      .btn-danger:hover:not(:disabled) {
        background: #c82333;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }

      .btn-warning {
        background: #ffc107;
        color: #333;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      }

      .btn-warning:hover:not(:disabled) {
        background: #e0a800;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }

      .modo-edicao .field-value {
        display: none;
      }

      .modo-edicao .field-input {
        display: block;
      }

      .modo-visualizacao .field-value {
        display: block;
      }

      .modo-visualizacao .field-input {
        display: none;
      }

      /* Breakpoints seguindo padr√µes da ind√∫stria (mobile-first approach) */
      /* Mobile: at√© 639px */
      @media (max-width: 639px) {
        .form-row {
          grid-template-columns: 1fr;
        }

        .campanhas-grid {
          grid-template-columns: 1fr;
          gap: 16px;
        }

        /* Layout vertical otimizado para mobile (touch-friendly) */
        .campanhas-list .campanha-card {
          flex-direction: column;
          align-items: stretch;
          gap: 12px;
        }

        .campanhas-list .campanha-card .campanha-info {
          min-width: auto;
        }

        .campanhas-list .campanha-card .campanha-info .meta-info {
          flex-direction: column;
          gap: 4px;
        }

        /* Bot√µes em linha para melhor uso do espa√ßo em mobile */
        .campanhas-list .campanha-card .actions {
          flex-wrap: wrap;
          gap: 6px;
        }

        .campanhas-list .campanha-card .actions button {
          flex: 1 1 calc(50% - 3px);
          min-width: 120px;
          padding: 8px 10px;
          font-size: 11px;
        }

        /* A√ß√£o prim√°ria ocupa largura total em mobile */
        .campanhas-list .campanha-card .actions button.btn-success {
          flex: 1 1 100%;
        }

        .view-toggle {
          flex-direction: column;
          align-items: stretch;
          padding: 12px;
        }

        .view-toggle-buttons {
          width: 100%;
          justify-content: center;
        }

        .clientes-table {
          font-size: 12px;
        }

        .clientes-table th,
        .clientes-table td {
          padding: 10px 8px;
        }
      }

      /* Tablet: 640px - 991px */
      @media (min-width: 640px) and (max-width: 991px) {
        .campanhas-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 18px;
        }

        /* Layout adaptativo para tablet */
        .campanhas-list .campanha-card {
          flex-wrap: wrap;
          gap: 12px;
        }

        .campanhas-list .campanha-card .campanha-info {
          flex: 1 1 60%;
          min-width: 300px;
        }

        .campanhas-list .campanha-card .actions {
          flex: 1 1 auto;
          justify-content: flex-end;
        }

        .campanhas-list .campanha-card .actions button {
          flex: 0 1 auto;
          min-width: 100px;
        }
      }

      /* Desktop: 992px+ */
      @media (min-width: 992px) {
        .campanhas-grid {
          grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
          gap: 24px;
        }

        /* Layout completo em desktop */
        .campanhas-list .campanha-card {
          flex-wrap: nowrap;
          align-items: flex-start;
        }

        .campanhas-list .campanha-card .campanha-info {
          flex: 1 1 0;
          min-width: 300px;
          max-width: 70%;
        }

        .campanhas-list .campanha-card .actions {
          flex: 0 0 auto;
          flex-shrink: 0;
          align-items: center;
          justify-content: flex-end;
          margin-left: 16px;
        }
      }

      /* Large Desktop: 1200px+ - Otimiza√ß√µes para telas grandes */
      @media (min-width: 1200px) {
        .campanhas-list .campanha-card {
          padding: 12px;
          gap: 16px;
        }

        .campanhas-list .campanha-card .campanha-info {
          max-width: 75%;
        }

        .campanhas-list .campanha-card .actions {
          margin-left: 20px;
        }
      }

      /* Estilos para Tooltips e Help Icons */
      .help-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #667eea;
        color: white;
        font-size: 12px;
        font-weight: bold;
        cursor: help;
        margin-left: 6px;
        vertical-align: middle;
        transition: all 0.2s ease;
        position: relative;
        flex-shrink: 0;
      }

      .help-icon:hover {
        background: #5568d3;
        transform: scale(1.1);
      }

      .help-icon:focus {
        outline: 2px solid #667eea;
        outline-offset: 2px;
      }

      /* Tooltip hover (r√°pido) */
      .tooltip-hover {
        position: fixed;
        background: #1f2937;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        white-space: nowrap;
        z-index: 10000;
        pointer-events: none;
        opacity: 0;
        transform: translateY(-5px);
        transition: opacity 0.2s ease, transform 0.2s ease;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        max-width: 300px;
        white-space: normal;
        line-height: 1.4;
        top: 0;
        left: 0;
      }

      .tooltip-hover.show {
        opacity: 1;
        transform: translateY(0);
      }

      .tooltip-hover::after {
        content: "";
        position: absolute;
        bottom: -5px;
        left: 20px;
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 5px solid #1f2937;
      }

      /* Popover de detalhes (click) */
      .tooltip-popover {
        position: fixed;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 20px;
        z-index: 10001;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        display: none;
        animation: fadeIn 0.2s ease;
        transition: opacity 0.2s ease;
      }
      
      .tooltip-popover.show {
        display: block;
      }

      .tooltip-popover.show {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .tooltip-popover-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e5e7eb;
      }

      .tooltip-popover-header h4 {
        margin: 0;
        color: #111827;
        font-size: 1.1rem;
        font-weight: 600;
      }

      .tooltip-popover-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #6b7280;
        padding: 0;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.2s ease;
      }

      .tooltip-popover-close:hover {
        background: #f3f4f6;
        color: #111827;
      }

      .tooltip-popover-content {
        color: #374151;
        font-size: 14px;
        line-height: 1.6;
      }

      .tooltip-popover-content h5 {
        margin: 15px 0 8px 0;
        color: #111827;
        font-size: 0.95rem;
        font-weight: 600;
      }

      .tooltip-popover-content ul,
      .tooltip-popover-content ol {
        margin: 10px 0;
        padding-left: 20px;
      }

      .tooltip-popover-content li {
        margin: 5px 0;
      }

      .tooltip-popover-content code {
        background: #f3f4f6;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 0.9em;
        color: #dc2626;
      }

      .tooltip-popover-content pre {
        background: #f9fafb;
        padding: 12px;
        border-radius: 6px;
        overflow-x: auto;
        margin: 10px 0;
        border: 1px solid #e5e7eb;
      }

      .tooltip-popover-content pre code {
        background: none;
        padding: 0;
        color: #111827;
      }

      .tooltip-exemplos {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e5e7eb;
      }

      .tooltip-exemplo-item {
        background: #f9fafb;
        padding: 10px;
        border-radius: 6px;
        margin: 8px 0;
        border-left: 3px solid #667eea;
      }

      .tooltip-exemplo-item code {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
      }

      .tooltip-exemplo-item .descricao {
        color: #6b7280;
        font-size: 0.9em;
      }

      /* Overlay para fechar popover ao clicar fora */
      .tooltip-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        background: transparent;
        display: none;
      }

      .tooltip-overlay.show {
        display: block;
      }

      /* Label com help icon */
      label.with-help {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      /* Responsivo para tooltips */
      @media (max-width: 639px) {
        .tooltip-popover {
          max-width: 90vw;
          padding: 15px;
        }

        .help-icon {
          width: 16px;
          height: 16px;
          font-size: 11px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <button class="sidebar-toggle-btn" onclick="toggleSidebar()" title="Colapsar/Expandir" aria-label="Colapsar sidebar">
            <span style="font-size: 1.25rem;">‚Üê</span>
          </button>
          <div class="sidebar-logo">IC</div>
          <div class="sidebar-title">Instacar</div>
        </div>
        <div class="sidebar-user">
          Logado como:<br />
          <strong id="userEmail">luizcceconi@gmail.com</strong>
        </div>
        <nav class="sidebar-nav">
          <a href="#/" class="sidebar-nav-item active" data-page="dashboard">
            <span class="sidebar-nav-item-icon">üìä</span>
            <span class="sidebar-nav-item-text">Dashboard</span>
          </a>
          <a href="#/clientes" class="sidebar-nav-item" data-page="clientes">
            <span class="sidebar-nav-item-icon">üë•</span>
            <span class="sidebar-nav-item-text">Clientes</span>
          </a>
          <a href="#/templates" class="sidebar-nav-item" data-page="templates">
            <span class="sidebar-nav-item-icon">üìù</span>
            <span class="sidebar-nav-item-text">Templates</span>
          </a>
          <a href="#/campanhas" class="sidebar-nav-item" data-page="campanhas">
            <span class="sidebar-nav-item-icon">‚úàÔ∏è</span>
            <span class="sidebar-nav-item-text">Campanhas</span>
          </a>
          <a href="#/listas" class="sidebar-nav-item" data-page="listas">
            <span class="sidebar-nav-item-icon">üìã</span>
            <span class="sidebar-nav-item-text">Listas de Clientes</span>
          </a>
          <a href="#/agendamentos" class="sidebar-nav-item" data-page="agendamentos">
            <span class="sidebar-nav-item-icon">üìÖ</span>
            <span class="sidebar-nav-item-text">Agendamentos</span>
          </a>
          <a href="#/historico" class="sidebar-nav-item" data-page="historico">
            <span class="sidebar-nav-item-icon">üìã</span>
            <span class="sidebar-nav-item-text">Hist√≥rico</span>
          </a>
          <a href="#/instancias" class="sidebar-nav-item" data-page="instancias">
            <span class="sidebar-nav-item-icon">üì±</span>
            <span class="sidebar-nav-item-text">Inst√¢ncias</span>
          </a>
          <a href="#/configuracoes" class="sidebar-nav-item" data-page="configuracoes">
            <span class="sidebar-nav-item-icon">‚öôÔ∏è</span>
            <span class="sidebar-nav-item-text">Configura√ß√µes</span>
          </a>
        </nav>
        <div class="sidebar-footer">
          <button class="sidebar-logout" onclick="logout()">
            <span>‚Üí</span>
            <span>Sair</span>
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <div class="main-content" id="mainContent">
        <!-- Header -->
        <header class="header">
          <button class="mobile-menu-toggle" onclick="toggleSidebar()" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <!-- Bot√£o para abrir sidebar quando colapsada (desktop) -->
          <button class="sidebar-open-btn" onclick="toggleSidebar()" aria-label="Abrir menu" title="Abrir menu lateral">
            <span style="font-size: 1.5rem;">‚ò∞</span>
          </button>
          <div class="header-left">
            <h1 class="header-title" id="pageTitle">Dashboard</h1>
            <p class="header-subtitle" id="pageSubtitle">Vis√£o geral do sistema de disparos</p>
          </div>
          <div class="header-right">
            <div class="header-search">
              <span class="header-search-icon">üîç</span>
              <input type="text" placeholder="Buscar..." id="globalSearch" />
            </div>
            <div class="header-actions">
              <button class="header-icon-btn" onclick="abrirModalAjuda()" title="Ajuda">
                ‚ùì
              </button>
              <button class="header-icon-btn" onclick="abrirModalNotificacoes()" title="Notifica√ß√µes">
                üîî
                <span class="header-icon-badge" id="notificationBadge" style="display: none;"></span>
              </button>
              <div class="header-user" onclick="navegarPara('/perfil')" title="Perfil">
                LC
              </div>
            </div>
          </div>
        </header>

        <!-- Content Area -->
        <div class="content" id="contentArea">
          <div id="alertContainer"></div>
          
          <!-- Banner de Migra√ß√£o de Listas -->
          <div id="bannerMigracaoListas" class="alert alert-info" style="margin: 20px; display: none; padding: 15px; background: #e0f2fe; border: 1px solid #3b82f6; border-radius: 8px; color: #1e40af;">
            ‚úÖ Suas sele√ß√µes de clientes foram migradas para o novo sistema de listas.
            Confira em <a href="#/listas" onclick="if(typeof loadPageListas === 'function') loadPageListas();" style="color: #3b82f6; text-decoration: underline; font-weight: 600;">Listas de Clientes</a>.
            <button onclick="document.getElementById('bannerMigracaoListas').style.display='none'; localStorage.setItem('bannerMigracaoListasFechado', 'true');" style="float: right; background: none; border: none; font-size: 1.2em; cursor: pointer; color: #1e40af;">‚úï</button>
          </div>
          
          <!-- Conte√∫do existente (mantido para compatibilidade) -->
          <div id="legacyContent" data-page-content="dashboard">

      <div class="config-section">
        <h2>‚ûï Nova Campanha</h2>
        <button onclick="abrirModalNovaCampanha()">Criar Nova Campanha</button>
      </div>

      <div class="config-section">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
          "
        >
          <h2 style="margin: 0">üìã Campanhas Existentes</h2>
          <div class="view-toggle">
            <span class="view-toggle-label">Visualiza√ß√£o:</span>
            <div class="view-toggle-buttons">
              <button
                class="view-toggle-btn active"
                id="viewToggleGrid"
                onclick="alternarVisualizacaoCampanhas('grid')"
                title="Visualiza√ß√£o em blocos"
                aria-label="Visualiza√ß√£o em blocos"
              >
                ‚¨ú
              </button>
              <button
                class="view-toggle-btn"
                id="viewToggleList"
                onclick="alternarVisualizacaoCampanhas('list')"
                title="Visualiza√ß√£o em lista"
                aria-label="Visualiza√ß√£o em lista"
              >
                ‚ò∞
              </button>
            </div>
          </div>
        </div>
        <div id="campanhasContainer" class="loading">
          <p>Carregando campanhas...</p>
        </div>
      </div>

      <!-- Se√ß√£o: Dados Din√¢micos do Agente IA -->
      <div class="config-section">
        <h2>ü§ñ Dados Din√¢micos do Agente IA</h2>
        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
          "
        >
          <div
            style="
              border: 1px solid #ddd;
              border-radius: 8px;
              padding: 15px;
              background: #f9f9f9;
            "
          >
            <h3 style="margin-top: 0; font-size: 1.1em">
              ‚öôÔ∏è Configura√ß√µes da Empresa
            </h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px">
              Gerencie configura√ß√µes globais (pol√≠ticas, tom de voz, informa√ß√µes
              da empresa)
            </p>
            <button
              onclick="abrirModalConfiguracaoEmpresa()"
              class="btn-primary"
              style="width: 100%"
            >
              Gerenciar Configura√ß√µes
            </button>
          </div>
          <div
            style="
              border: 1px solid #ddd;
              border-radius: 8px;
              padding: 15px;
              background: #f9f9f9;
            "
          >
            <h3 style="margin-top: 0; font-size: 1.1em">
              üìù Sess√µes de Contexto
            </h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px">
              Gerencie blocos de contexto pr√©-definidos para o agente IA
            </p>
            <button
              onclick="abrirModalSessaoContexto()"
              class="btn-primary"
              style="width: 100%"
            >
              Gerenciar Sess√µes
            </button>
          </div>
          <div
            style="
              border: 1px solid #ddd;
              border-radius: 8px;
              padding: 15px;
              background: #f9f9f9;
            "
          >
            <h3 style="margin-top: 0; font-size: 1.1em">
              üìã Templates de Prompt
            </h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px">
              Gerencie templates completos de prompt para campanhas
            </p>
            <button
              onclick="abrirModalTemplatePrompt()"
              class="btn-primary"
              style="width: 100%"
            >
              Gerenciar Templates
            </button>
          </div>
        </div>
      </div>

      <!-- Se√ß√£o Upload de Planilhas -->
      <div class="config-section">
        <h2>üì§ Upload de Planilhas</h2>
        <div id="uploadSection">
          <div
            class="upload-area"
            id="uploadArea"
            style="
              border: 2px dashed #667eea;
              border-radius: 8px;
              padding: 40px;
              text-align: center;
              margin-bottom: 20px;
              cursor: pointer;
              transition: background 0.3s;
            "
          >
            <p style="color: #667eea; font-size: 18px; margin-bottom: 10px">
              üìÅ Arraste arquivos aqui ou clique para selecionar
            </p>
            <p style="color: #666; font-size: 14px">
              Formatos suportados: .xls, .xlsx, .csv, .txt
            </p>
            <input
              type="file"
              id="fileInput"
              accept=".xls,.xlsx,.csv,.txt"
              style="display: none"
              multiple
            />
          </div>

          <div class="form-group">
            <label>Ou cole URL do Google Sheets</label>
            <div style="display: flex; gap: 10px">
              <input
                type="text"
                id="googleSheetsUrl"
                placeholder="https://docs.google.com/spreadsheets/d/..."
                style="flex: 1"
              />
              <button
                type="button"
                onclick="processarGoogleSheets()"
                class="btn-secondary"
              >
                Processar
              </button>
            </div>
          </div>

          <div id="uploadProgress" style="display: none; margin-top: 20px">
            <div
              style="
                background: #f0f0f0;
                border-radius: 4px;
                height: 30px;
                position: relative;
                overflow: hidden;
              "
            >
              <div
                id="progressBar"
                style="
                  background: #667eea;
                  height: 100%;
                  width: 0%;
                  transition: width 0.3s;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  color: white;
                  font-weight: bold;
                "
              >
                0%
              </div>
            </div>
            <p
              id="progressText"
              style="margin-top: 10px; color: #666; text-align: center"
            >
              Processando...
            </p>
          </div>

          <div id="uploadResults" style="margin-top: 20px"></div>
        </div>
      </div>

      <!-- Se√ß√£o Gerenciar Clientes -->
      <div class="config-section">
        <h2>üë• Gerenciar Clientes</h2>
        <div id="clientesSection">
          <div
            style="
              display: flex;
              gap: 10px;
              margin-bottom: 20px;
              flex-wrap: wrap;
            "
          >
            <input
              type="text"
              id="buscaClientes"
              placeholder="Buscar por nome ou telefone..."
              style="flex: 1; min-width: 200px"
              onkeyup="if(event.key === 'Enter') { paginaAtualClientes = 1; carregarListaClientes(1); }"
            />
            <select
              id="filtroStatusWhatsapp"
              style="width: 200px"
              onchange="paginaAtualClientes = 1; carregarListaClientes(1)"
            >
              <option value="">Todos os status</option>
              <option value="valid">WhatsApp V√°lido</option>
              <option value="invalid">WhatsApp Inv√°lido</option>
              <option value="unknown">N√£o Verificado</option>
            </select>
            <select
              id="ordenacaoCampo"
              style="width: 180px"
              onchange="paginaAtualClientes = 1; carregarListaClientes(1)"
            >
              <option value="nome_cliente" selected>Nome (A-Z)</option>
              <option value="ultimo_envio">√öltimo Envio</option>
              <option value="status_whatsapp">Status WhatsApp</option>
              <option value="bloqueado_envios">Status Bloqueio</option>
            </select>
            <select
              id="ordenacaoDirecao"
              style="width: 120px"
              onchange="paginaAtualClientes = 1; carregarListaClientes(1)"
            >
              <option value="asc" selected>Crescente ‚Üë</option>
              <option value="desc">Decrescente ‚Üì</option>
            </select>
            <label
              style="
                display: flex;
                align-items: center;
                gap: 5px;
                white-space: nowrap;
              "
            >
              Itens por p√°gina:
              <select
                id="itensPorPagina"
                style="width: 80px"
                onchange="paginaAtualClientes = 1; carregarListaClientes(1)"
              >
                <option value="10">10</option>
                <option value="25" selected>25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </label>
            <button
              type="button"
              onclick="carregarListaClientes()"
              class="btn-success"
            >
              üîÑ Atualizar
            </button>
            <button
              type="button"
              onclick="verificarWhatsAppSelecionados(false)"
              class="btn-secondary"
              title="Verifica todos os clientes n√£o verificados no banco de dados"
            >
              ‚úÖ Verificar Todos N√£o Verificados
            </button>
            <button
              type="button"
              onclick="verificarWhatsAppSelecionados(true)"
              class="btn-secondary"
              title="Verifica apenas os clientes vis√≠veis na p√°gina atual"
            >
              ‚úÖ Verificar P√°gina Atual
            </button>
            <button
              type="button"
              onclick="adicionarNovoCliente()"
              class="btn-success"
            >
              ‚ûï Novo Cliente
            </button>
          </div>

          <!-- Indicador de Progresso da Verifica√ß√£o WhatsApp -->
          <div
            id="progressoVerificacaoWhatsApp"
            style="
              display: none;
              background: #f0f9ff;
              border: 2px solid #0ea5e9;
              border-radius: 8px;
              padding: 20px;
              margin-bottom: 20px;
            "
          >
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px">
              <span style="font-size: 24px">‚è≥</span>
              <div style="flex: 1">
                <h3 style="margin: 0; color: #0c4a6e; font-size: 16px">
                  Verificando WhatsApp em andamento...
                </h3>
                <p
                  id="statusVerificacaoTexto"
                  style="margin: 5px 0 0 0; color: #0369a1; font-size: 14px"
                >
                  Preparando verifica√ß√£o...
                </p>
              </div>
            </div>
            <div
              style="
                background: #e0f2fe;
                border-radius: 6px;
                height: 30px;
                position: relative;
                overflow: hidden;
                margin-bottom: 10px;
              "
            >
              <div
                id="barraProgressoVerificacao"
                style="
                  background: linear-gradient(90deg, #0ea5e9 0%, #3b82f6 100%);
                  height: 100%;
                  width: 0%;
                  transition: width 0.3s ease;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  color: white;
                  font-weight: bold;
                  font-size: 12px;
                "
              >
                0%
              </div>
            </div>
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-size: 13px;
                color: #0369a1;
              "
            >
              <span id="contadorVerificacao">0 / 0 processados</span>
              <span id="tempoEstimadoVerificacao"></span>
            </div>
          </div>

          <div id="clientesContainer" class="loading">
            <p>Carregando clientes...</p>
          </div>

          <div
            id="paginacaoClientes"
            style="
              display: flex;
              justify-content: center;
              gap: 10px;
              margin-top: 20px;
              align-items: center;
            "
          ></div>
        </div>
      </div>

      <!-- Se√ß√£o de Status e Configura√ß√µes (Rodap√©) -->
      <div
        class="config-section"
        style="
          margin-top: 40px;
          border-top: 2px solid #e0e0e0;
          padding-top: 20px;
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
          "
        >
          <h2>üìä Status do Sistema</h2>
          <button
            class="btn-secondary"
            onclick="abrirModalConfiguracoes()"
            style="padding: 8px 16px; font-size: 13px"
          >
            ‚öôÔ∏è Gerenciar Configura√ß√µes
          </button>
        </div>
        <div
          id="statusContainer"
          style="display: flex; gap: 15px; flex-wrap: wrap"
        >
          <div
            id="statusSupabase"
            style="
              flex: 1;
              min-width: 200px;
              padding: 15px;
              border-radius: 8px;
              background: #f8f9fa;
              border: 2px solid #ddd;
            "
          >
            <div
              style="
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 5px;
              "
            >
              <span id="statusSupabaseIcon" style="font-size: 20px">‚è≥</span>
              <strong>Supabase</strong>
            </div>
            <p
              id="statusSupabaseText"
              style="margin: 0; color: #666; font-size: 14px"
            >
              Verificando conex√£o...
            </p>
          </div>
          <div
            id="statusUazapi"
            style="
              flex: 1;
              min-width: 200px;
              padding: 15px;
              border-radius: 8px;
              background: #f8f9fa;
              border: 2px solid #ddd;
            "
          >
            <div
              style="
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 5px;
              "
            >
              <span id="statusUazapiIcon" style="font-size: 20px">‚è≥</span>
              <strong>Uazapi (WhatsApp)</strong>
            </div>
            <p
              id="statusUazapiText"
              style="margin: 0; color: #666; font-size: 14px"
            >
              Verificando configura√ß√£o...
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Configura√ß√µes -->
    <div id="modalConfiguracoes" class="modal">
      <div class="modal-content" style="max-width: 700px">
        <div class="modal-header">
          <h2>‚öôÔ∏è Gerenciar Configura√ß√µes</h2>
          <button class="close" onclick="fecharModalConfiguracoes()">
            &times;
          </button>
        </div>

        <div
          style="
            margin-bottom: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 15px;
            "
          >
            <h3 style="color: #333; margin: 0; font-size: 1.1em">
              Uazapi (WhatsApp API) - Inst√¢ncias
            </h3>
            <button
              type="button"
              onclick="abrirModalNovaInstanciaUazapi()"
              class="btn-success"
              style="padding: 6px 12px; font-size: 12px"
            >
              ‚ûï Adicionar Inst√¢ncia
            </button>
          </div>

          <div id="instanciasUazapiList" style="margin-bottom: 15px">
            <p style="color: #666; font-style: italic">
              Carregando inst√¢ncias...
            </p>
          </div>
        </div>

        <div
          style="
            margin-bottom: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
          "
        >
          <h3 style="color: #333; margin-bottom: 15px; font-size: 1.1em">
            N8N Webhook
          </h3>
          <div class="form-group">
            <label>URL do Webhook N8N</label>
            <input
              type="text"
              id="configN8nWebhook"
              placeholder="https://seu-n8n.com/webhook/campanha"
            />
            <small style="color: #666; display: block; margin-top: 5px">
              URL do webhook para disparo manual de campanhas (opcional)
            </small>
          </div>
        </div>

        <div
          style="
            margin-bottom: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
          "
        >
          <h3 style="color: #333; margin-bottom: 15px; font-size: 1.1em">
            A√ß√µes
          </h3>
          <div style="display: flex; gap: 10px; flex-wrap: wrap">
            <button
              type="button"
              class="btn-success"
              onclick="salvarConfiguracoes()"
            >
              üíæ Salvar Configura√ß√µes
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="carregarConfiguracoesNoModal()"
            >
              üì• Carregar do LocalStorage
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="exportarConfiguracoes()"
            >
              üì§ Exportar JSON
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="importarConfiguracoes()"
            >
              üì• Importar JSON
            </button>
            <button
              type="button"
              class="btn-danger"
              onclick="limparConfiguracoes()"
            >
              üóëÔ∏è Limpar Tudo
            </button>
          </div>
        </div>

        <div
          style="
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
          "
        >
          <small style="color: #666">
            üí° <strong>Dica:</strong> As configura√ß√µes s√£o salvas no navegador
            (localStorage). Para usar em outro navegador, exporte e importe o
            JSON.
          </small>
        </div>
      </div>
    </div>

    <!-- Modal Nova/Editar Inst√¢ncia Uazapi -->
    <div id="modalInstanciaUazapi" class="modal">
      <div class="modal-content" style="max-width: 600px">
        <div class="modal-header">
          <h2 id="modalInstanciaUazapiTitle">Nova Inst√¢ncia Uazapi</h2>
          <button class="close" onclick="fecharModalInstanciaUazapi()">
            &times;
          </button>
        </div>
        <form id="formInstanciaUazapi">
          <input type="hidden" id="instanciaUazapiId" />

          <div class="form-group">
            <label>Nome da Inst√¢ncia *</label>
            <input
              type="text"
              id="instanciaUazapiNome"
              required
              placeholder="Ex: uazapi-principal (ser√°: Instacar_a3k9m2_uazapi-principal)"
            />
            <small style="color: #666">
              ‚ö†Ô∏è <strong>Digite apenas o nome</strong> (sem o prefixo
              "Instacar_"). O prefixo ser√° adicionado automaticamente.
              <br />
              Nome ser√° normalizado: min√∫sculas, espa√ßos viram underscores,
              acentos removidos. H√≠fens e underscores existentes s√£o
              preservados.
              <br />
              <strong>Exemplos:</strong>
              <ul style="margin: 5px 0; padding-left: 20px">
                <li>
                  Digite "N√∫mero 02" ‚Üí Ser√° salvo como
                  "Instacar_a3k9m2_numero_02"
                </li>
                <li>
                  Digite "numero-01" ‚Üí Ser√° salvo como
                  "Instacar_a3k9m2_numero-01" (h√≠fen preservado)
                </li>
                <li>
                  Digite "numero_02" ‚Üí Ser√° salvo como
                  "Instacar_a3k9m2_numero_02" (underscore preservado)
                </li>
              </ul>
              C√≥digo de 6 caracteres gerado automaticamente.
            </small>
          </div>

          <div class="form-group">
            <label>Tipo de API *</label>
            <select id="instanciaUazapiTipoApi" required>
              <option value="uazapi">Uazapi</option>
              <option value="zapi">Z-API</option>
              <option value="evolution">Evolution API</option>
              <option value="whatsapp_oficial">WhatsApp Oficial (Meta)</option>
              <option value="outro">Outro</option>
            </select>
            <small style="color: #666">
              Selecione o tipo de API WhatsApp que esta inst√¢ncia utiliza
            </small>
          </div>

          <div class="form-group">
            <label>URL Base da Inst√¢ncia *</label>
            <input
              type="text"
              id="instanciaUazapiBaseUrl"
              required
              placeholder="https://sua-instancia.uazapi.com"
            />
            <small style="color: #666">
              URL base da sua inst√¢ncia (ex: https://fourtakeoff.uazapi.com,
              https://api.z-api.io)
            </small>
          </div>

          <div class="form-group">
            <label
              >Admin Token (Opcional - Apenas para criar novas inst√¢ncias na
              Uazapi)</label
            >
            <div style="display: flex; gap: 10px">
              <input
                type="password"
                id="instanciaUazapiAdminToken"
                placeholder="Seu admin token da Uazapi (opcional)"
                style="flex: 1"
              />
              <button
                type="button"
                onclick="togglePasswordVisibility('instanciaUazapiAdminToken')"
                style="padding: 10px 15px; white-space: nowrap"
              >
                üëÅÔ∏è
              </button>
            </div>
            <small style="color: #666">
              ‚ö†Ô∏è <strong>Quando usar Admin Token:</strong>
              <ul style="margin: 5px 0; padding-left: 20px">
                <li>
                  ‚úÖ <strong>Criar</strong> nova inst√¢ncia na Uazapi via
                  interface
                </li>
                <li>
                  ‚ùå <strong>N√£o precisa</strong> para editar inst√¢ncias
                  existentes
                </li>
                <li>
                  ‚ùå <strong>N√£o precisa</strong> para deletar inst√¢ncias (usa
                  Instance Token)
                </li>
              </ul>
              Se voc√™ j√° tem uma inst√¢ncia criada, deixe este campo vazio e use
              apenas o Instance Token abaixo.
            </small>
          </div>

          <div class="form-group">
            <label
              >Instance Token
              <span
                id="instanciaUazapiTokenRequired"
                style="color: red; display: none"
                >*</span
              ></label
            >
            <div style="display: flex; gap: 10px">
              <input
                type="password"
                id="instanciaUazapiToken"
                placeholder="Seu instance token da Uazapi (ser√° gerado automaticamente se fornecer Admin Token)"
                style="flex: 1"
              />
              <button
                type="button"
                onclick="togglePasswordVisibility('instanciaUazapiToken')"
                style="padding: 10px 15px; white-space: nowrap"
              >
                üëÅÔ∏è
              </button>
            </div>
            <small style="color: #666">
              <strong>Quando usar Instance Token:</strong>
              <ul style="margin: 5px 0; padding-left: 20px">
                <li>
                  ‚úÖ <strong>Obrigat√≥rio</strong> se voc√™ j√° tem uma inst√¢ncia
                  criada na Uazapi (n√£o forneceu Admin Token)
                </li>
                <li>
                  ‚úÖ <strong>Obrigat√≥rio</strong> para editar inst√¢ncias
                  existentes
                </li>
                <li>
                  ‚úÖ <strong>Obrigat√≥rio</strong> para APIs que n√£o sejam Uazapi
                </li>
                <li>
                  ‚ùå <strong>N√£o precisa</strong> se voc√™ forneceu Admin Token
                  acima (ser√° gerado automaticamente)
                </li>
              </ul>
              O Instance Token √© usado para opera√ß√µes regulares (conectar,
              enviar mensagens, deletar inst√¢ncias, etc.).
            </small>
          </div>

          <div class="form-group">
            <label>Descri√ß√£o (Opcional)</label>
            <textarea
              id="instanciaUazapiDescricao"
              rows="3"
              placeholder="Descri√ß√£o opcional desta inst√¢ncia..."
            ></textarea>
          </div>

          <div class="form-group">
            <label>Configura√ß√£o Extra (JSON - Opcional)</label>
            <textarea
              id="instanciaUazapiConfigExtra"
              rows="4"
              placeholder='{"instance_id": "xxx"} ou {"phone_id": "xxx", "business_account_id": "yyy"}'
            ></textarea>
            <small style="color: #666">
              Configura√ß√µes espec√≠ficas da API em formato JSON. Ex: Evolution
              precisa de {"instance_id": "xxx"}, WhatsApp Oficial precisa de
              {"phone_id": "xxx", "business_account_id": "yyy"}
            </small>
          </div>

          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 8px">
              <input
                type="checkbox"
                id="instanciaUazapiAtivo"
                checked
                style="width: auto"
              />
              Inst√¢ncia Ativa
            </label>
            <small style="color: #666">
              Desmarque para desativar esta inst√¢ncia (n√£o aparecer√° nas op√ß√µes
              de campanha)
            </small>
          </div>

          <div style="display: flex; gap: 10px; margin-top: 20px">
            <button type="submit" class="btn-success">
              üíæ Salvar Inst√¢ncia
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="fecharModalInstanciaUazapi()"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal de Ajuda -->
    <div id="modalAjuda" class="modal">
      <div class="modal-content" style="max-width: 900px; max-height: 90vh">
        <div class="modal-header">
          <h2>‚ùì Ajuda e Documenta√ß√£o</h2>
          <button class="close" onclick="fecharModalAjuda()">&times;</button>
        </div>
        <div style="overflow-y: auto; max-height: calc(90vh - 100px)">
          <!-- Tabs de navega√ß√£o -->
          <div
            class="modal-tabs"
            style="
              position: sticky;
              top: 0;
              background: white;
              z-index: 10;
              margin-bottom: 20px;
            "
          >
            <button
              class="modal-tab active"
              onclick="trocarTabAjuda('visao-geral')"
              id="tabVisaoGeral"
            >
              üìñ Vis√£o Geral
            </button>
            <button
              class="modal-tab"
              onclick="trocarTabAjuda('campos')"
              id="tabCampos"
            >
              üìù Campos do Formul√°rio
            </button>
            <button
              class="modal-tab"
              onclick="trocarTabAjuda('funcionalidades')"
              id="tabFuncionalidades"
            >
              ‚öôÔ∏è Funcionalidades
            </button>
            <button
              class="modal-tab"
              onclick="trocarTabAjuda('troubleshooting')"
              id="tabTroubleshooting"
            >
              üîß Troubleshooting
            </button>
          </div>

          <!-- Conte√∫do das tabs -->
          <div id="ajudaVisaoGeral" class="modal-tab-content active">
            <h3>Vis√£o Geral do Sistema</h3>
            <p>
              O <strong>Gerenciador de Campanhas</strong> √© um sistema completo
              para gerenciar e disparar campanhas de marketing via WhatsApp para
              a Instacar Autom√≥veis.
            </p>

            <h4>Como Funciona</h4>
            <ol>
              <li>
                <strong>Cadastro:</strong> Crie campanhas na interface web com
                todas as configura√ß√µes necess√°rias
              </li>
              <li>
                <strong>Processamento:</strong> O sistema N8N processa as
                campanhas automaticamente ou manualmente
              </li>
              <li>
                <strong>Envio:</strong> Mensagens s√£o geradas por IA e enviadas
                via WhatsApp usando a API configurada
              </li>
              <li>
                <strong>Monitoramento:</strong> Acompanhe envios, erros e
                estat√≠sticas em tempo real
              </li>
            </ol>

            <h4>Componentes Principais</h4>
            <ul>
              <li>
                <strong>Interface Web:</strong> Onde voc√™ est√° agora - gerencia
                campanhas, clientes e configura√ß√µes
              </li>
              <li>
                <strong>N8N:</strong> Motor de orquestra√ß√£o que processa as
                campanhas e envia mensagens
              </li>
              <li>
                <strong>Supabase:</strong> Banco de dados que armazena
                campanhas, clientes e hist√≥rico
              </li>
              <li>
                <strong>Uazapi/Z-API/Evolution:</strong> APIs de WhatsApp que
                fazem o envio real das mensagens
              </li>
              <li>
                <strong>OpenAI GPT-4:</strong> Gera mensagens personalizadas
                para cada cliente
              </li>
            </ul>

            <h4>Fluxo Completo</h4>
            <pre
              style="
                background: #f9fafb;
                padding: 15px;
                border-radius: 8px;
                border: 1px solid #e5e7eb;
              "
            >
Interface Web ‚Üí Salva Campanha no Supabase
     ‚Üì
Disparo Manual ou Agendamento Cron
     ‚Üì
N8N Workflow busca dados da campanha
     ‚Üì
Processa clientes eleg√≠veis
     ‚Üì
Gera mensagem personalizada (IA)
     ‚Üì
Envia via WhatsApp (Uazapi)
     ‚Üì
Registra no hist√≥rico (Supabase)
            </pre>
          </div>

          <div id="ajudaCampos" class="modal-tab-content">
            <h3>Guia de Campos do Formul√°rio</h3>
            <p>
              Esta se√ß√£o explica cada campo do formul√°rio de cria√ß√£o de
              campanha. Para ver ajuda espec√≠fica de um campo, passe o mouse ou
              clique no √≠cone
              <span class="help-icon" style="display: inline-flex">?</span> ao
              lado do label.
            </p>

            <h4>Campos B√°sicos</h4>
            <ul>
              <li>
                <strong>Nome da Campanha:</strong> Identificador √∫nico e
                descritivo
              </li>
              <li>
                <strong>Descri√ß√£o:</strong> Notas internas (n√£o enviadas aos
                clientes)
              </li>
              <li>
                <strong>Per√≠odo do Ano:</strong> √âpoca/ocasi√£o da campanha
              </li>
              <li>
                <strong>Status:</strong> Ativa, Pausada, Conclu√≠da ou Cancelada
              </li>
            </ul>

            <h4>Datas e Per√≠odos</h4>
            <ul>
              <li>
                <strong>Data In√≠cio/Fim:</strong> Per√≠odo de execu√ß√£o da
                campanha
              </li>
              <li>
                <strong>Hor√°rio In√≠cio/Fim:</strong> Janela di√°ria de
                processamento (padr√£o: 9h-18h)
              </li>
            </ul>

            <h4>Controle de Envios</h4>
            <ul>
              <li>
                <strong>Limite de Envios/Dia:</strong> M√°ximo de mensagens por
                dia (recomendado: 50 warm-up, 200 produ√ß√£o)
              </li>
              <li>
                <strong>Intervalo M√≠nimo (dias):</strong> Tempo entre envios
                para mesmo cliente (padr√£o: 30 dias)
              </li>
              <li>
                <strong>Intervalo Entre Envios:</strong> Tempo entre cada
                mensagem (padr√£o: 130-150s aleatorizado)
              </li>
              <li>
                <strong>Prioridade:</strong> Ordem quando cliente √© eleg√≠vel
                para m√∫ltiplas campanhas (1-10)
              </li>
            </ul>

            <h4>Configura√ß√µes de IA</h4>
            <ul>
              <li>
                <strong>Prompt Personalizado:</strong> Instru√ß√µes para a IA
                gerar mensagens. Use vari√°veis como
                <code>{{nome_cliente}}</code>, <code>{{data_hoje}}</code>, etc.
              </li>
              <li>
                <strong>Template de Mensagem:</strong> Base opcional para as
                mensagens
              </li>
              <li>
                <strong>Usar Ve√≠culos:</strong> Incluir dados de ve√≠culos no
                contexto da IA
              </li>
              <li>
                <strong>Usar Vendedor:</strong> Incluir nome do vendedor nas
                mensagens
              </li>
              <li>
                <strong>Usar Configura√ß√µes Globais:</strong> Incluir
                configura√ß√µes da empresa (pol√≠ticas, tom de voz, etc.) no
                contexto
              </li>
            </ul>

            <div
              style="
                background: #f0f9ff;
                border-left: 4px solid #3b82f6;
                padding: 12px;
                margin: 15px 0;
                border-radius: 4px;
              "
            >
              <strong>üí° Modo "Apenas Prompt Personalizado":</strong>
              <p style="margin: 8px 0 0 0">
                Se voc√™ <strong>desmarcar todas</strong> as configura√ß√µes de IA
                (Usar Ve√≠culos, Usar Configura√ß√µes Globais, Sess√µes de Contexto)
                e preencher o Prompt Personalizado, o sistema enviar√°
                <strong>apenas o prompt</strong> com o m√≠nimo de contexto (nome
                do cliente). Isso economiza tokens e d√° controle total sobre o
                que a IA recebe.
              </p>
              <p style="margin: 8px 0 0 0">
                <strong>Quando usar:</strong> Campanhas simples onde voc√™ quer
                controle total, sem contexto adicional da empresa ou ve√≠culos.
              </p>
            </div>

            <h4>Processamento</h4>
            <ul>
              <li>
                <strong>Tamanho do Lote:</strong> Clientes processados por
                execu√ß√£o (padr√£o: 50)
              </li>
              <li>
                <strong>Processar Finais de Semana:</strong> Se deve processar
                s√°bados e domingos
              </li>
              <li>
                <strong>Agendamento Cron:</strong> Agendamento autom√°tico (veja
                se√ß√£o dedicada)
              </li>
            </ul>
          </div>

          <!-- Se√ß√£o de ajuda sobre Agendamento Cron removida - agora usa Hor√°rio In√≠cio/Fim -->
          <div id="ajudaCron" class="modal-tab-content" style="display: none;">
            <h3>Agendamento Cron - Guia Completo</h3>
            <p>
              O agendamento cron permite executar campanhas automaticamente em
              hor√°rios espec√≠ficos.
            </p>

            <h4>Formato Cron</h4>
            <p>O formato cron √©: <code>minuto hora dia m√™s dia-semana</code></p>

            <table
              style="width: 100%; border-collapse: collapse; margin: 15px 0"
            >
              <thead>
                <tr style="background: #f9fafb">
                  <th
                    style="
                      padding: 10px;
                      border: 1px solid #e5e7eb;
                      text-align: left;
                    "
                  >
                    Campo
                  </th>
                  <th
                    style="
                      padding: 10px;
                      border: 1px solid #e5e7eb;
                      text-align: left;
                    "
                  >
                    Valores
                  </th>
                  <th
                    style="
                      padding: 10px;
                      border: 1px solid #e5e7eb;
                      text-align: left;
                    "
                  >
                    Descri√ß√£o
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">
                    <strong>Minuto</strong>
                  </td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">0-59</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">
                    Minuto da hora
                  </td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">
                    <strong>Hora</strong>
                  </td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">0-23</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">
                    Hora do dia (formato 24h)
                  </td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">
                    <strong>Dia do m√™s</strong>
                  </td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">1-31</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">
                    Dia do m√™s
                  </td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">
                    <strong>M√™s</strong>
                  </td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">1-12</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">
                    M√™s do ano
                  </td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">
                    <strong>Dia da semana</strong>
                  </td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">0-7</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb">
                    0 e 7 = Domingo, 1 = Segunda, ..., 6 = S√°bado
                  </td>
                </tr>
              </tbody>
            </table>

            <h4>Caracteres Especiais</h4>
            <ul>
              <li>
                <code>*</code> - Qualquer valor (ex: <code>* * * * *</code> = a
                cada minuto)
              </li>
              <li>
                <code>,</code> - Lista de valores (ex: <code>1,3,5</code> = 1, 3
                ou 5)
              </li>
              <li>
                <code>-</code> - Intervalo (ex: <code>1-5</code> = de 1 a 5)
              </li>
              <li>
                <code>/</code> - Incremento (ex: <code>*/2</code> = a cada 2)
              </li>
            </ul>

            <h4>Exemplos Pr√°ticos</h4>
            <div
              style="
                background: #f9fafb;
                padding: 15px;
                border-radius: 8px;
                margin: 15px 0;
              "
            >
              <div
                style="
                  margin: 10px 0;
                  padding: 10px;
                  background: white;
                  border-left: 3px solid #667eea;
                  border-radius: 4px;
                "
              >
                <code style="font-size: 16px; font-weight: bold"
                  >0 9 * * 1-5</code
                >
                <p style="margin: 5px 0 0 0; color: #666">
                  9h da manh√£, apenas dias √∫teis (segunda a sexta)
                </p>
              </div>
              <div
                style="
                  margin: 10px 0;
                  padding: 10px;
                  background: white;
                  border-left: 3px solid #667eea;
                  border-radius: 4px;
                "
              >
                <code style="font-size: 16px; font-weight: bold"
                  >0 9 1 1 *</code
                >
                <p style="margin: 5px 0 0 0; color: #666">
                  1¬∫ de janeiro √†s 9h
                </p>
              </div>
              <div
                style="
                  margin: 10px 0;
                  padding: 10px;
                  background: white;
                  border-left: 3px solid #667eea;
                  border-radius: 4px;
                "
              >
                <code style="font-size: 16px; font-weight: bold"
                  >0 */2 * * *</code
                >
                <p style="margin: 5px 0 0 0; color: #666">
                  A cada 2 horas (0h, 2h, 4h, 6h, 8h...)
                </p>
              </div>
              <div
                style="
                  margin: 10px 0;
                  padding: 10px;
                  background: white;
                  border-left: 3px solid #667eea;
                  border-radius: 4px;
                "
              >
                <code style="font-size: 16px; font-weight: bold"
                  >30 14 * * 0</code
                >
                <p style="margin: 5px 0 0 0; color: #666">Domingos √†s 14:30</p>
              </div>
              <div
                style="
                  margin: 10px 0;
                  padding: 10px;
                  background: white;
                  border-left: 3px solid #667eea;
                  border-radius: 4px;
                "
              >
                <code style="font-size: 16px; font-weight: bold"
                  >0 9,14 * * 1-5</code
                >
                <p style="margin: 5px 0 0 0; color: #666">
                  9h e 14h, apenas dias √∫teis
                </p>
              </div>
              <div
                style="
                  margin: 10px 0;
                  padding: 10px;
                  background: white;
                  border-left: 3px solid #667eea;
                  border-radius: 4px;
                "
              >
                <code style="font-size: 16px; font-weight: bold"
                  >0 0 1 * *</code
                >
                <p style="margin: 5px 0 0 0; color: #666">
                  Todo dia 1 de cada m√™s √† meia-noite
                </p>
              </div>
            </div>

            <h4>Dicas</h4>
            <ul>
              <li>
                Deixe o campo vazio se n√£o quiser agendamento autom√°tico
                (disparo apenas manual)
              </li>
              <li>Use hor√°rios comerciais (9h-18h) para evitar bloqueios</li>
              <li>
                Evite processar em finais de semana (a menos que necess√°rio)
              </li>
              <li>
                Teste primeiro com uma campanha de teste antes de usar em
                produ√ß√£o
              </li>
            </ul>
          </div>

          <div id="ajudaFuncionalidades" class="modal-tab-content">
            <h3>Funcionalidades Principais</h3>

            <h4>Gerenciar Campanhas</h4>
            <ul>
              <li>
                <strong>Criar Campanha:</strong> Clique em "Criar Nova Campanha"
                e preencha o formul√°rio
              </li>
              <li>
                <strong>Editar Campanha:</strong> Clique no bot√£o "‚úèÔ∏è Editar" na
                campanha desejada
              </li>
              <li>
                <strong>Disparar Manualmente:</strong> Clique em "üöÄ Disparar"
                para executar a campanha imediatamente
              </li>
              <li>
                <strong>Pausar/Reativar:</strong> Altere o status da campanha
                para pausar ou reativar
              </li>
            </ul>

            <h4>Upload de Planilhas</h4>
            <ul>
              <li>Arraste arquivos XLSX, CSV ou TXT na √°rea de upload</li>
              <li>Ou cole a URL de um Google Sheets</li>
              <li>
                O sistema detecta automaticamente as colunas e normaliza
                telefones
              </li>
              <li>Clientes com mesmo telefone s√£o agrupados automaticamente</li>
            </ul>

            <h4>Gerenciar Clientes</h4>
            <ul>
              <li>
                <strong>Buscar:</strong> Use a barra de busca para encontrar
                clientes por nome ou telefone
              </li>
              <li>
                <strong>Filtrar:</strong> Filtre por status do WhatsApp (V√°lido,
                Inv√°lido, N√£o Verificado)
              </li>
              <li>
                <strong>Ver Detalhes:</strong> Clique em um cliente para ver
                informa√ß√µes completas
              </li>
              <li>
                <strong>Editar:</strong> Clique em "‚úèÔ∏è Editar" no modal de
                detalhes
              </li>
              <li>
                <strong>Adicionar Ve√≠culo:</strong> Adicione ve√≠culos aos
                clientes no modal de detalhes
              </li>
              <li>
                <strong>Enviar Mensagem Individual:</strong> Use o bot√£o "üì§
                Enviar" para enviar mensagem direta
              </li>
            </ul>

            <h4>Configurar Inst√¢ncias WhatsApp</h4>
            <ul>
              <li>V√° em "‚öôÔ∏è Gerenciar Configura√ß√µes"</li>
              <li>Clique em "‚ûï Adicionar Inst√¢ncia"</li>
              <li>
                Preencha os dados da sua API (Uazapi, Z-API, Evolution, etc.)
              </li>
              <li>Selecione a inst√¢ncia ao criar/editar uma campanha</li>
            </ul>
          </div>

          <div id="ajudaTroubleshooting" class="modal-tab-content">
            <h3>Troubleshooting</h3>

            <h4>Problemas Comuns</h4>

            <h5>Campanha n√£o est√° enviando mensagens</h5>
            <ul>
              <li>Verifique se o status est√° "Ativa"</li>
              <li>Confirme se a data de in√≠cio j√° passou (se configurada)</li>
              <li>Verifique se h√° clientes eleg√≠veis na base</li>
              <li>Confirme se a inst√¢ncia WhatsApp est√° ativa e configurada</li>
              <li>Verifique os logs do N8N para erros</li>
            </ul>

            <h5>Erro de conex√£o com Supabase</h5>
            <ul>
              <li>Verifique se as vari√°veis de ambiente est√£o configuradas</li>
              <li>Confirme se est√° usando a Anon Key (n√£o Service Key)</li>
              <li>
                Verifique se as pol√≠ticas RLS est√£o configuradas corretamente
              </li>
            </ul>

            <h5>Mensagens n√£o est√£o sendo geradas pela IA</h5>
            <ul>
              <li>Verifique se o prompt da IA est√° preenchido</li>
              <li>Confirme se a API key do OpenAI est√° configurada no N8N</li>
              <li>Verifique os logs do N8N para erros da API OpenAI</li>
            </ul>

            <h5>WhatsApp bloqueando mensagens</h5>
            <ul>
              <li>Reduza o limite di√°rio (use 50 durante warm-up)</li>
              <li>Aumente o intervalo entre envios</li>
              <li>Evite enviar em finais de semana</li>
              <li>Respeite a janela de hor√°rio comercial (9h-18h)</li>
              <li>Verifique se os n√∫meros de telefone s√£o v√°lidos</li>
            </ul>

            <h4>Como Verificar Status</h4>
            <ul>
              <li>
                <strong>Status do Sistema:</strong> Veja os indicadores no
                rodap√© da p√°gina
              </li>
              <li>
                <strong>Status da Campanha:</strong> Veja os badges na lista de
                campanhas
              </li>
              <li>
                <strong>Hist√≥rico de Envios:</strong> Abra os detalhes do
                cliente e v√° na aba "Hist√≥rico"
              </li>
              <li>
                <strong>Logs do N8N:</strong> Acesse o N8N para ver logs
                detalhados de execu√ß√£o
              </li>
            </ul>

            <h4>Contatos de Suporte</h4>
            <p>Se o problema persistir:</p>
            <ul>
              <li>
                Verifique a documenta√ß√£o completa em
                <code>docs/campanhas/GUIA-COMPLETO-CAMPANHAS.md</code>
              </li>
              <li>Consulte os logs do N8N para erros espec√≠ficos</li>
              <li>
                Verifique o status das APIs (Supabase, Uazapi, OpenAI) nos
                respectivos pain√©is
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

          </div>
          <!-- Fim do conte√∫do legacy -->
        </div>
      </div>
      
    <!-- Modal Detalhes do Cliente (movido para fora do contentArea para garantir acesso) -->
    <div id="modalCliente" class="modal modal-cliente">
      <div class="modal-content" style="max-width: 1000px; max-height: 90vh;">
        <div class="modal-header">
          <h2 id="modalClienteTitle">Detalhes do Cliente</h2>
          <button class="close" onclick="fecharModalCliente()">&times;</button>
        </div>
        <div id="modalClienteLoading" style="text-align: center; padding: 40px">
          <p>Carregando dados do cliente...</p>
        </div>
        <div id="modalClienteContent" style="display: none; overflow-y: auto; max-height: calc(90vh - 120px);">
          <input type="hidden" id="clienteId" />

          <!-- Tabs -->
          <div class="modal-tabs" style="display: flex; gap: 0.5rem; border-bottom: 1px solid hsl(var(--border)); margin-bottom: 1.5rem;">
            <button
              class="modal-tab active"
              onclick="trocarTabCliente('dados')"
              style="padding: 0.75rem 1.5rem; background: none; border: none; border-bottom: 2px solid transparent; cursor: pointer; font-weight: 500; color: hsl(var(--muted-foreground)); transition: all 0.2s;"
            >
              üìã Dados
            </button>
            <button 
              class="modal-tab" 
              onclick="trocarTabCliente('observacoes')"
              style="padding: 0.75rem 1.5rem; background: none; border: none; border-bottom: 2px solid transparent; cursor: pointer; font-weight: 500; color: hsl(var(--muted-foreground)); transition: all 0.2s;"
            >
              üìù Observa√ß√µes
            </button>
            <button 
              class="modal-tab" 
              onclick="trocarTabCliente('historico')"
              style="padding: 0.75rem 1.5rem; background: none; border: none; border-bottom: 2px solid transparent; cursor: pointer; font-weight: 500; color: hsl(var(--muted-foreground)); transition: all 0.2s;"
            >
              üì® Hist√≥rico
            </button>
          </div>

          <!-- Tab Dados -->
          <div id="tabDados" class="modal-tab-content active">
            <!-- Bot√µes de A√ß√£o -->
            <div class="form-actions" style="justify-content: flex-start; border: none; padding: 0; margin-bottom: 1.5rem;">
              <button
                id="btnEditarCliente"
                class="btn btn-outline"
                onclick="alternarModoEdicao()"
              >
                ‚úèÔ∏è Editar
              </button>
              <button
                id="btnSalvarCliente"
                class="btn btn-primary"
                onclick="salvarEdicaoCliente()"
                style="display: none"
              >
                üíæ Salvar
              </button>
              <button
                id="btnCancelarEdicao"
                class="btn btn-outline"
                onclick="cancelarEdicao()"
                style="display: none"
              >
                ‚ùå Cancelar
              </button>
            </div>

            <!-- Formul√°rio de Dados -->
            <div class="form-section">
              <div class="form-group">
                <label class="form-label">Nome do Cliente <small>(obrigat√≥rio)</small></label>
                <div class="modo-visualizacao" id="fieldNomeValue" style="padding: 0.625rem 0.875rem; color: hsl(var(--foreground)); font-size: 0.875rem; border: 1px solid hsl(var(--border)); border-radius: var(--radius-md); background: hsl(var(--muted) / 0.3); min-height: 2.5rem; display: flex; align-items: center;"></div>
                <input
                  type="text"
                  class="form-input modo-edicao"
                  id="fieldNomeInput"
                  required
                />
              </div>

              <div class="form-group">
                <label class="form-label">Telefone <small>(obrigat√≥rio)</small></label>
                <div class="modo-visualizacao" id="fieldTelefoneValue" style="padding: 0.625rem 0.875rem; color: hsl(var(--foreground)); font-size: 0.875rem; border: 1px solid hsl(var(--border)); border-radius: var(--radius-md); background: hsl(var(--muted) / 0.3); min-height: 2.5rem; display: flex; align-items: center;"></div>
                <input
                  type="text"
                  class="form-input modo-edicao"
                  id="fieldTelefoneInput"
                  placeholder="Ex: (11) 98765-4321 ou 11987654321"
                  required
                />
                <small class="form-help-text">
                  Formato esperado: 55 + DDD + n√∫mero<br>
                  ‚Ä¢ Fixo: 8 d√≠gitos (ex: 551112345678)<br>
                  ‚Ä¢ Celular: 9 d√≠gitos (ex: 5511987654321) - n√∫meros antigos s√£o padronizados automaticamente
                </small>
                <div
                  id="fieldTelefoneValidacao"
                  class="validation-message modo-edicao"
                  style="
                    font-size: 0.8125rem;
                    margin-top: 0.5rem;
                    padding: 0.5rem;
                    border-radius: var(--radius-md);
                  "
                ></div>
              </div>

              <div class="form-group">
                <label class="form-label">Email</label>
                <div class="modo-visualizacao" id="fieldEmailValue" style="padding: 0.625rem 0.875rem; color: hsl(var(--foreground)); font-size: 0.875rem; border: 1px solid hsl(var(--border)); border-radius: var(--radius-md); background: hsl(var(--muted) / 0.3); min-height: 2.5rem; display: flex; align-items: center;"></div>
                <input 
                  type="email" 
                  class="form-input modo-edicao" 
                  id="fieldEmailInput"
                />
              </div>

              <div class="form-group">
                <label class="form-label">Bloqueado para Envios</label>
                <div class="modo-visualizacao" id="fieldBloqueadoEnviosValue" style="padding: 0.625rem 0.875rem; color: hsl(var(--foreground)); font-size: 0.875rem; border: 1px solid hsl(var(--border)); border-radius: var(--radius-md); background: hsl(var(--muted) / 0.3); min-height: 2.5rem; display: flex; align-items: center;"></div>
                <label class="form-label modo-edicao" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-top: 0.5rem;">
                  <input
                    type="checkbox"
                    id="fieldBloqueadoEnviosInput"
                    class="form-checkbox"
                    style="width: auto; margin: 0;"
                  />
                  <span>üö´ N√£o enviar mensagens (Bloqueado)</span>
                </label>
                <small class="form-help-text">
                  Se marcado, este cliente n√£o receber√° mensagens de campanhas, mesmo que esteja selecionado.
                </small>
              </div>

              <div class="form-group">
                <label class="form-label">Status WhatsApp</label>
                <div class="modo-visualizacao" id="fieldStatusWhatsappValue" style="padding: 0.625rem 0.875rem; color: hsl(var(--foreground)); font-size: 0.875rem; border: 1px solid hsl(var(--border)); border-radius: var(--radius-md); background: hsl(var(--muted) / 0.3); min-height: 2.5rem; display: flex; align-items: center;"></div>
                <button
                  class="btn btn-outline modo-visualizacao"
                  onclick="verificarWhatsAppDoModal()"
                  style="margin-top: 0.5rem;"
                >
                  ‚úÖ Verificar WhatsApp
                </button>
              </div>
            </div>

            <!-- Estat√≠sticas -->
            <div class="card-elevated" style="padding: 1.5rem; margin-bottom: 1.5rem;">
              <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: hsl(var(--foreground));">Estat√≠sticas de Envios</h3>
              <div class="stats-grid" style="gap: 1rem;">
                <div class="card-elevated" style="padding: 1rem; text-align: center;">
                  <div style="font-size: 1.5rem; font-weight: 700; color: hsl(var(--primary));" id="statTotalEnvios">0</div>
                  <div style="font-size: 0.8125rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">Total de Envios</div>
                </div>
                <div class="card-elevated" style="padding: 1rem; text-align: center;">
                  <div style="font-size: 1.5rem; font-weight: 700; color: hsl(var(--foreground));" id="statPrimeiroEnvio">-</div>
                  <div style="font-size: 0.8125rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">Primeiro Envio</div>
                </div>
                <div class="card-elevated" style="padding: 1rem; text-align: center;">
                  <div style="font-size: 1.5rem; font-weight: 700; color: hsl(var(--foreground));" id="statUltimoEnvio">-</div>
                  <div style="font-size: 0.8125rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">√öltimo Envio</div>
                </div>
                <div class="card-elevated" style="padding: 1rem; text-align: center;">
                  <div style="font-size: 1.5rem; font-weight: 700; color: hsl(var(--primary));" id="statCampanhasEnviadas">0</div>
                  <div style="font-size: 0.8125rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">Campanhas Diferentes</div>
                </div>
              </div>
              <!-- Lista resumida de campanhas -->
              <div id="statCampanhasLista" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid hsl(var(--border));">
                <div style="font-size: 0.875rem; font-weight: 500; color: hsl(var(--foreground)); margin-bottom: 0.5rem;">Campanhas j√° disparadas:</div>
                <div id="statCampanhasListaContent" style="font-size: 0.8125rem; color: hsl(var(--muted-foreground));">
                  <em>Nenhuma campanha ainda</em>
                </div>
                <div style="margin-top: 0.5rem; font-size: 0.75rem; color: hsl(var(--muted-foreground));">
                  <em>üí° Para ver detalhes completos, acesse a aba "Hist√≥rico"</em>
                </div>
              </div>
            </div>

            <!-- Ve√≠culos -->
            <div class="form-section">
              <div class="form-group">
                <label class="form-label">Ve√≠culos</label>
                <div id="veiculosList" class="veiculos-list" style="margin-bottom: 1rem;"></div>
                <div id="veiculoForm" class="card-elevated modo-edicao" style="padding: 1rem; margin-bottom: 1rem; display: none;">
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">Marca</label>
                      <input
                        type="text"
                        id="veiculoMarca"
                        placeholder="Marca"
                        class="form-input"
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Modelo</label>
                      <input
                        type="text"
                        id="veiculoModelo"
                        placeholder="Modelo"
                        class="form-input"
                      />
                    </div>
                  </div>
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">Ano</label>
                      <input
                        type="text"
                        id="veiculoAno"
                        placeholder="Ano"
                        class="form-input"
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Placa</label>
                      <input
                        type="text"
                        id="veiculoPlaca"
                        placeholder="Placa"
                        class="form-input"
                      />
                    </div>
                  </div>
                  <div class="form-actions" style="justify-content: flex-start; border: none; padding: 0; margin-top: 0.5rem;">
                    <button
                      class="btn btn-primary"
                      onclick="adicionarVeiculoCliente()"
                    >
                      ‚ûï Adicionar
                    </button>
                    <button
                      class="btn btn-outline"
                      onclick="cancelarAdicionarVeiculo()"
                    >
                      Cancelar
                    </button>
                  </div>
                </div>
                <button
                  class="btn btn-outline modo-visualizacao"
                  onclick="mostrarFormVeiculo()"
                  id="btnMostrarFormVeiculo"
                >
                  ‚ûï Adicionar Ve√≠culo
                </button>
              </div>
            </div>

            <!-- Datas -->
            <div class="form-section">
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Data de Cria√ß√£o</label>
                  <div class="field-value" id="fieldCreatedAt" style="padding: 0.625rem 0.875rem; color: hsl(var(--muted-foreground)); font-size: 0.875rem;"></div>
                </div>
                <div class="form-group">
                  <label class="form-label">√öltima Atualiza√ß√£o</label>
                  <div class="field-value" id="fieldUpdatedAt" style="padding: 0.625rem 0.875rem; color: hsl(var(--muted-foreground)); font-size: 0.875rem;"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab Observa√ß√µes -->
          <div id="tabObservacoes" class="modal-tab-content" style="display: none;">
            <div class="card-elevated" style="padding: 1.5rem; margin-bottom: 1.5rem;">
              <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: hsl(var(--foreground));">Observa√ß√µes Registradas</h3>
              <div class="observacoes-list" id="observacoesList">
                <p style="text-align: center; color: hsl(var(--muted-foreground)); padding: 2rem;">
                  Nenhuma observa√ß√£o registrada.
                </p>
              </div>
            </div>
            <div class="form-section">
              <div class="form-group">
                <label class="form-label">Nova Observa√ß√£o</label>
                <textarea
                  id="novaObservacaoTexto"
                  class="form-textarea"
                  placeholder="Digite uma observa√ß√£o sobre o cliente..."
                  rows="4"
                ></textarea>
              </div>
              <div class="form-actions" style="justify-content: flex-start; border: none; padding: 0;">
                <button
                  class="btn btn-primary"
                  onclick="adicionarObservacaoCliente()"
                >
                  ‚ûï Adicionar Observa√ß√£o
                </button>
              </div>
            </div>
          </div>

          <!-- Tab Hist√≥rico -->
          <div id="tabHistorico" class="modal-tab-content" style="display: none;">
            <!-- Estat√≠sticas Resumidas -->
            <div class="card-elevated" style="padding: 1.5rem; margin-bottom: 1.5rem;">
              <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: hsl(var(--foreground));">Estat√≠sticas do Hist√≥rico</h3>
              <div class="stats-grid" style="gap: 1rem;">
                <div class="card-elevated" style="padding: 1rem; text-align: center; background: hsl(var(--primary) / 0.05);">
                  <div style="font-size: 1.5rem; font-weight: 700; color: hsl(var(--primary));" id="statTotalHistorico">0</div>
                  <div style="font-size: 0.8125rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">Total de Envios</div>
                </div>
                <div class="card-elevated" style="padding: 1rem; text-align: center; background: hsl(var(--success) / 0.05);">
                  <div style="font-size: 1.5rem; font-weight: 700; color: hsl(var(--success));" id="statEnviadosHistorico">0</div>
                  <div style="font-size: 0.8125rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">Enviados com Sucesso</div>
                </div>
                <div class="card-elevated" style="padding: 1rem; text-align: center; background: hsl(var(--destructive) / 0.05);">
                  <div style="font-size: 1.5rem; font-weight: 700; color: hsl(var(--destructive));" id="statErrosHistorico">0</div>
                  <div style="font-size: 0.8125rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">Erros</div>
                </div>
                <div class="card-elevated" style="padding: 1rem; text-align: center; background: hsl(var(--warning) / 0.05);">
                  <div style="font-size: 1.5rem; font-weight: 700; color: hsl(var(--warning));" id="statCampanhasHistorico">0</div>
                  <div style="font-size: 0.8125rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">Campanhas Diferentes</div>
                </div>
              </div>
            </div>

            <!-- Filtros -->
            <div class="card-elevated" style="padding: 1.5rem; margin-bottom: 1.5rem;">
              <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: hsl(var(--foreground));">Filtros</h3>
              <div class="form-row" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                <div class="form-group">
                  <label class="form-label">Campanha</label>
                  <select
                    id="filtroCampanhaHistorico"
                    class="form-select"
                    onchange="filtrarHistorico()"
                  >
                    <option value="">Todas as campanhas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Status</label>
                  <select
                    id="filtroStatusHistorico"
                    class="form-select"
                    onchange="filtrarHistorico()"
                  >
                    <option value="">Todos os status</option>
                    <option value="enviado">Enviado</option>
                    <option value="erro">Erro</option>
                    <option value="bloqueado">Bloqueado</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Data In√≠cio</label>
                  <input
                    type="date"
                    id="filtroDataInicioHistorico"
                    class="form-input"
                    onchange="filtrarHistorico()"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Data Fim</label>
                  <input
                    type="date"
                    id="filtroDataFimHistorico"
                    class="form-input"
                    onchange="filtrarHistorico()"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Buscar na Mensagem</label>
                  <input
                    type="text"
                    id="filtroBuscaTextoHistorico"
                    class="form-input"
                    placeholder="Buscar na mensagem..."
                    onkeyup="filtrarHistorico()"
                  />
                </div>
              </div>
              <div class="form-actions" style="justify-content: flex-start; border: none; padding: 0; margin-top: 1rem;">
                <button
                  class="btn btn-primary"
                  onclick="exportarHistorico()"
                  title="Exportar hist√≥rico filtrado para CSV"
                >
                  üì• Exportar CSV
                </button>
                <button
                  class="btn btn-outline"
                  onclick="limparFiltrosHistorico()"
                  title="Limpar todos os filtros"
                >
                  üîÑ Limpar Filtros
                </button>
              </div>
            </div>

            <!-- Pagina√ß√£o -->
            <div id="historicoPaginacao" style="display: none; margin-bottom: 1rem; text-align: center;">
              <button id="btnPaginaAnterior" class="btn btn-outline" onclick="mudarPaginaHistorico(-1)">‚Üê Anterior</button>
              <span id="infoPaginaHistorico" style="margin: 0 1rem; color: hsl(var(--muted-foreground));">P√°gina 1 de 1</span>
              <button id="btnPaginaProxima" class="btn btn-outline" onclick="mudarPaginaHistorico(1)">Pr√≥xima ‚Üí</button>
            </div>

            <!-- Tabela -->
            <div class="card-elevated" style="padding: 0; overflow: hidden;">
              <div style="overflow-x: auto; max-height: 500px; overflow-y: auto">
                <table class="data-table" style="width: 100%;">
                  <thead>
                    <tr>
                      <th>Data/Hora</th>
                      <th>Status</th>
                      <th>Tipo</th>
                      <th>Campanha</th>
                      <th>Mensagem</th>
                    </tr>
                  </thead>
                  <tbody id="historicoEnviosBody">
                    <tr>
                      <td
                        colspan="5"
                        style="text-align: center; padding: 2rem; color: hsl(var(--muted-foreground));"
                      >
                        Carregando hist√≥rico...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- A√ß√µes do Modal -->
          <div class="form-actions">
            <button
              class="btn btn-outline"
              onclick="desativarCliente(document.getElementById('clienteId').value)"
              id="btnDesativarCliente"
            >
              üö´ Desativar Cliente
            </button>
            <button
              class="btn btn-destructive"
              onclick="excluirCliente(document.getElementById('clienteId').value)"
              id="btnExcluirCliente"
            >
              üóëÔ∏è Excluir Cliente
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Configura√ß√µes da Empresa -->
    <div id="modalConfiguracaoEmpresa" class="modal">
      <div class="modal-content" style="max-width: 900px; max-height: 90vh">
        <div class="modal-header">
          <h2 id="modalConfiguracaoEmpresaTitle">
            ‚öôÔ∏è Gerenciar Configura√ß√µes da Empresa
          </h2>
          <button class="close" onclick="fecharModalConfiguracaoEmpresa()">
            &times;
          </button>
        </div>
        <div style="overflow-y: auto; max-height: calc(90vh - 100px)">
          <div style="margin-bottom: 20px">
            <button
              onclick="abrirModalFormConfiguracaoEmpresa()"
              class="btn-success"
              style="margin-bottom: 15px"
            >
              ‚ûï Nova Configura√ß√£o
            </button>
            <div id="listaConfiguracoesEmpresa">
              <p>Carregando configura√ß√µes...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Nova/Editar Configura√ß√£o Empresa -->
    <div id="modalFormConfiguracaoEmpresa" class="modal">
      <div class="modal-content" style="max-width: 700px">
        <div class="modal-header">
          <h2 id="modalFormConfiguracaoEmpresaTitle">Nova Configura√ß√£o</h2>
          <button class="close" onclick="fecharModalFormConfiguracaoEmpresa()">
            &times;
          </button>
        </div>
        <form
          id="formConfiguracaoEmpresa"
          onsubmit="event.preventDefault(); salvarConfiguracaoEmpresa(document.getElementById('configEmpresaId').value)"
        >
          <input type="hidden" id="configEmpresaId" />
          <div class="form-group">
            <label>Chave *</label>
            <input
              type="text"
              id="configEmpresaChave"
              required
              placeholder="ex: politicas.tom_voz"
            />
            <small style="color: #666"
              >Identificador √∫nico (ex: politicas.tom_voz,
              sobre_empresa.missao)</small
            >
          </div>
          <div class="form-group">
            <label>Categoria *</label>
            <select id="configEmpresaCategoria" required>
              <option value="politicas">Pol√≠ticas</option>
              <option value="tom_voz">Tom de Voz</option>
              <option value="contato">Contato</option>
              <option value="sobre_empresa">Sobre a Empresa</option>
              <option value="ofertas">Ofertas</option>
              <option value="produtos">Produtos</option>
            </select>
          </div>
          <div class="form-group">
            <label>T√≠tulo *</label>
            <input type="text" id="configEmpresaTitulo" required />
          </div>
          <div class="form-group">
            <label>Conte√∫do *</label>
            <textarea id="configEmpresaConteudo" rows="6" required></textarea>
            <small style="color: #666"
              >Pode usar vari√°veis: {{nome_cliente}}, {{data_hoje}},
              {{periodo_ano}}, etc.</small
            >
          </div>
          <div class="form-group">
            <label>Descri√ß√£o</label>
            <textarea id="configEmpresaDescricao" rows="2"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Ordem</label>
              <input type="number" id="configEmpresaOrdem" value="0" min="0" />
            </div>
            <div class="form-group">
              <label
                style="display: flex; align-items: center; cursor: pointer"
              >
                <input
                  type="checkbox"
                  id="configEmpresaAtivo"
                  checked
                  style="width: auto; margin-right: 8px"
                />
                <span>Ativo</span>
              </label>
            </div>
          </div>
          <div style="display: flex; gap: 10px; margin-top: 20px">
            <button type="submit" class="btn-success">Salvar</button>
            <button
              type="button"
              class="btn-secondary"
              onclick="fecharModalFormConfiguracaoEmpresa()"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Sess√µes de Contexto -->
    <div id="modalSessaoContexto" class="modal">
      <div class="modal-content" style="max-width: 900px; max-height: 90vh">
        <div class="modal-header">
          <h2 id="modalSessaoContextoTitle">
            üìù Gerenciar Sess√µes de Contexto
          </h2>
          <button class="close" onclick="fecharModalSessaoContexto()">
            &times;
          </button>
        </div>
        <div style="overflow-y: auto; max-height: calc(90vh - 100px)">
          <div style="margin-bottom: 20px">
            <button
              onclick="abrirModalFormSessaoContexto()"
              class="btn-success"
              style="margin-bottom: 15px"
            >
              ‚ûï Nova Sess√£o
            </button>
            <div id="listaSessoesContexto">
              <p>Carregando sess√µes...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Nova/Editar Sess√£o Contexto -->
    <div id="modalFormSessaoContexto" class="modal">
      <div class="modal-content" style="max-width: 800px">
        <div class="modal-header">
          <h2 id="modalFormSessaoContextoTitle">Nova Sess√£o</h2>
          <button class="close" onclick="fecharModalSessaoContexto()">
            &times;
          </button>
        </div>
        <form
          id="formSessaoContexto"
          onsubmit="event.preventDefault(); salvarSessaoContexto(document.getElementById('sessaoId').value)"
        >
          <input type="hidden" id="sessaoId" />
          <div class="form-group">
            <label>Nome *</label>
            <input type="text" id="sessaoNome" required />
          </div>
          <div class="form-group">
            <label>Slug *</label>
            <input
              type="text"
              id="sessaoSlug"
              required
              placeholder="ex: sobre_empresa"
            />
            <small style="color: #666"
              >Identificador √∫nico (ex: sobre_empresa, ofertas_especiais)</small
            >
          </div>
          <div class="form-group">
            <label>Categoria</label>
            <input
              type="text"
              id="sessaoCategoria"
              placeholder="ex: institucional, promocional"
            />
          </div>
          <div class="form-group">
            <label>Template de Conte√∫do *</label>
            <textarea id="sessaoConteudoTemplate" rows="8" required></textarea>
            <small style="color: #666"
              >Pode usar vari√°veis: {{nome_cliente}}, {{data_hoje}},
              {{veiculos.length}}, etc.</small
            >
          </div>
          <div class="form-group">
            <label>Exemplo Preenchido</label>
            <textarea id="sessaoExemploPreenchido" rows="4"></textarea>
            <small style="color: #666"
              >Exemplo j√° preenchido para refer√™ncia</small
            >
          </div>
          <div class="form-group">
            <label>Descri√ß√£o</label>
            <textarea id="sessaoDescricao" rows="2"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Ordem</label>
              <input type="number" id="sessaoOrdem" value="0" min="0" />
            </div>
            <div class="form-group">
              <label
                style="display: flex; align-items: center; cursor: pointer"
              >
                <input
                  type="checkbox"
                  id="sessaoHabilitadoPorPadrao"
                  style="width: auto; margin-right: 8px"
                />
                <span>Habilitado por Padr√£o</span>
              </label>
            </div>
            <div class="form-group">
              <label
                style="display: flex; align-items: center; cursor: pointer"
              >
                <input
                  type="checkbox"
                  id="sessaoAtivo"
                  checked
                  style="width: auto; margin-right: 8px"
                />
                <span>Ativo</span>
              </label>
            </div>
          </div>
          <div style="display: flex; gap: 10px; margin-top: 20px">
            <button type="submit" class="btn-success">Salvar</button>
            <button
              type="button"
              class="btn-secondary"
              onclick="fecharModalSessaoContexto()"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Templates de Prompt -->
    <div id="modalTemplatePrompt" class="modal">
      <div class="modal-content" style="max-width: 900px; max-height: 90vh">
        <div class="modal-header">
          <h2 id="modalTemplatePromptTitle">
            üìã Gerenciar Templates de Prompt
          </h2>
          <button class="close" onclick="fecharModalTemplatePrompt()">
            &times;
          </button>
        </div>
        <div style="overflow-y: auto; max-height: calc(90vh - 100px)">
          <div style="margin-bottom: 20px">
            <button
              onclick="abrirModalFormTemplatePrompt()"
              class="btn-success"
              style="margin-bottom: 15px"
            >
              ‚ûï Novo Template
            </button>
            <div id="listaTemplatesPrompt">
              <p>Carregando templates...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Nova/Editar Template Prompt -->
    <div id="modalFormTemplatePrompt" class="modal">
      <div class="modal-content" style="max-width: 900px; max-height: 90vh">
        <div class="modal-header">
          <h2 id="modalFormTemplatePromptTitle">Novo Template</h2>
          <button class="close" onclick="fecharModalTemplatePrompt()">
            &times;
          </button>
        </div>
        <form
          id="formTemplatePrompt"
          onsubmit="event.preventDefault(); salvarTemplatePrompt(document.getElementById('templateId').value)"
          style="overflow-y: auto; max-height: calc(90vh - 150px)"
        >
          <input type="hidden" id="templateId" />
          <div class="form-group">
            <label>Nome *</label>
            <input type="text" id="templateNome" required />
          </div>
          <div class="form-group">
            <label>Descri√ß√£o</label>
            <textarea id="templateDescricao" rows="2"></textarea>
          </div>
          <div class="form-group">
            <label>Prompt Completo *</label>
            <textarea id="templatePromptCompleto" rows="10" required></textarea>
            <small style="color: #666"
              >Template completo do prompt. Pode usar vari√°veis:
              {{nome_cliente}}, {{data_hoje}}, etc.</small
            >
          </div>
          <div class="form-group">
            <label>Categoria *</label>
            <select id="templateCategoria" required>
              <option value="natal">Natal</option>
              <option value="black-friday">Black Friday</option>
              <option value="relacionamento">Relacionamento</option>
              <option value="promocional">Promocional</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="form-group">
            <label>Exemplo de Uso</label>
            <textarea id="templateExemploUso" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label>Sess√µes Habilitadas por Padr√£o</label>
            <div
              id="templateSessoesHabilitadas"
              style="
                max-height: 150px;
                overflow-y: auto;
                border: 1px solid #ddd;
                padding: 10px;
                border-radius: 4px;
              "
            >
              <p style="color: #666; font-size: 14px">Carregando sess√µes...</p>
            </div>
          </div>
          <div class="form-group">
            <label>Configura√ß√µes Habilitadas por Padr√£o</label>
            <div
              id="templateConfiguracoesHabilitadas"
              style="
                max-height: 150px;
                overflow-y: auto;
                border: 1px solid #ddd;
                padding: 10px;
                border-radius: 4px;
              "
            >
              <p style="color: #666; font-size: 14px">
                Carregando configura√ß√µes...
              </p>
            </div>
          </div>
          <div class="form-group">
            <label style="display: flex; align-items: center; cursor: pointer">
              <input
                type="checkbox"
                id="templateAtivo"
                checked
                style="width: auto; margin-right: 8px"
              />
              <span>Ativo</span>
            </label>
          </div>
          <div style="display: flex; gap: 10px; margin-top: 20px">
            <button type="submit" class="btn-success">Salvar</button>
            <button
              type="button"
              class="btn-secondary"
              onclick="fecharModalTemplatePrompt()"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

          </div>
          <!-- Fim do conte√∫do legacy -->
        </div>
      </div>
      
    <!-- Overlay e Popover de Tooltip (fora do legacyContent para garantir acesso) -->
    <div
      class="tooltip-overlay"
      id="tooltipOverlay"
      onclick="fecharTooltipPopover()"
    ></div>

    <div class="tooltip-popover" id="tooltipPopover">
      <div class="tooltip-popover-header">
        <h4 id="tooltipPopoverTitle"></h4>
        <button class="tooltip-popover-close" onclick="fecharTooltipPopover()">
          &times;
        </button>
      </div>
      <div class="tooltip-popover-content" id="tooltipPopoverContent"></div>
    </div>

    <!-- Modal Enviar Mensagem Individual (fora do legacyContent para garantir acesso) -->
    <div id="modalEnviarMensagem" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üì§ Enviar Mensagem Individual</h2>
          <button class="close" onclick="fecharModalEnviarMensagem()">
            &times;
          </button>
        </div>
        <form id="formEnviarMensagem">
          <input type="hidden" id="enviarMensagemClienteId" />
          <input type="hidden" id="enviarMensagemTelefone" />

          <div class="form-section">
            <h3 style="font-size: 1rem; font-weight: 600; color: hsl(var(--foreground)); margin-bottom: 1rem;">Informa√ß√µes do Cliente</h3>
            
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Cliente</label>
                <input
                  type="text"
                  id="enviarMensagemClienteNome"
                  class="form-input"
                  readonly
                  style="background: hsl(var(--muted)); cursor: not-allowed;"
                />
              </div>

              <div class="form-group">
                <label class="form-label">Telefone</label>
                <input
                  type="text"
                  id="enviarMensagemClienteTelefone"
                  class="form-input"
                  readonly
                  style="background: hsl(var(--muted)); cursor: not-allowed;"
                />
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3 style="font-size: 1rem; font-weight: 600; color: hsl(var(--foreground)); margin-bottom: 1rem;">Configura√ß√£o do Envio</h3>
            
            <div class="form-group">
              <label class="form-label">Inst√¢ncia WhatsApp <span style="color: hsl(var(--destructive));">*</span></label>
              <select id="enviarMensagemInstanciaId" class="form-select" required>
                <option value="">Carregando inst√¢ncias...</option>
              </select>
              <div class="form-help-text">
                Selecione a inst√¢ncia WhatsApp que ser√° usada para enviar a mensagem
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Tipo de Envio <span style="color: hsl(var(--destructive));">*</span></label>
              <select id="tipoEnvio" class="form-select" required onchange="toggleTipoEnvio()">
                <option value="">Selecione...</option>
                <option value="campanha">Usar Campanha Existente</option>
                <option value="customizada">Mensagem Customizada</option>
              </select>
            </div>

            <div
              class="form-group"
              id="campanhaSelectGroup"
              style="display: none"
            >
              <label class="form-label">Selecionar Campanha <span style="color: hsl(var(--destructive));">*</span></label>
              <select id="campanhaSelecionada" class="form-select">
                <option value="">Carregando campanhas...</option>
              </select>
            </div>

            <div
              class="form-group"
              id="mensagemCustomizadaGroup"
              style="display: none"
            >
              <label class="form-label">Mensagem Customizada <span style="color: hsl(var(--destructive));">*</span></label>
              <textarea
                id="mensagemCustomizada"
                class="form-textarea"
                rows="6"
                placeholder="Digite a mensagem personalizada aqui..."
              ></textarea>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary" style="display: flex; align-items: center; gap: 0.5rem;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
              Enviar Mensagem
            </button>
            <button
              type="button"
              class="btn btn-outline"
              onclick="fecharModalEnviarMensagem()"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Nova/Editar Campanha -->
    <div id="modalCampanha" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalTitle">Nova Campanha</h2>
          <button class="close" onclick="fecharModal()">&times;</button>
        </div>
        <form id="formCampanha">
          <input type="hidden" id="campanhaId" />

          <div class="form-group">
            <label>Nome da Campanha <small>(obrigat√≥rio)</small></label>
            <input type="text" id="nome" class="form-input" required />
          </div>

          <div class="form-group">
            <label>Descri√ß√£o</label>
            <textarea id="descricao" class="form-textarea" rows="3"></textarea>
            <small>Campo opcional para notas internas</small>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Per√≠odo do Ano <small>(obrigat√≥rio)</small></label>
              <select id="periodo_ano" class="form-select" required>
                <option value="">Selecione...</option>
                <option value="janeiro">Janeiro</option>
                <option value="fevereiro">Fevereiro</option>
                <option value="marco">Mar√ßo</option>
                <option value="abril">Abril</option>
                <option value="maio">Maio</option>
                <option value="junho">Junho</option>
                <option value="julho">Julho</option>
                <option value="agosto">Agosto</option>
                <option value="setembro">Setembro</option>
                <option value="outubro">Outubro</option>
                <option value="novembro">Novembro</option>
                <option value="dezembro">Dezembro</option>
                <option value="black-friday">Black Friday</option>
                <option value="dia-maes">Dia das M√£es</option>
                <option value="dia-pais">Dia dos Pais</option>
                <option value="natal">Natal</option>
                <option value="ano-novo">Ano Novo</option>
              </select>
            </div>

            <div class="form-group">
              <label>Status <small>(obrigat√≥rio)</small></label>
              <select id="status" class="form-select" required>
                <option value="ativa">Ativa</option>
                <option value="pausada">Pausada</option>
                <option value="concluida">Conclu√≠da</option>
                <option value="cancelada">Cancelada</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Data In√≠cio</label>
              <input type="date" id="data_inicio" class="form-input" />
            </div>

            <div class="form-group">
              <label>Data Fim</label>
              <input type="date" id="data_fim" class="form-input" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Limite de Envios/Dia</label>
              <input type="number" id="limite_envios_dia" class="form-input" value="200" min="1" />
            </div>

            <div class="form-group">
              <label>Intervalo M√≠nimo (dias)</label>
              <input
                type="number"
                id="intervalo_minimo_dias"
                class="form-input"
                value="30"
                min="1"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Atraso Inteligente Entre Mensagens</label>
              
              <!-- Op√ß√µes pr√©-definidas -->
              <div class="form-section" style="padding: 1rem; margin-bottom: 0.75rem;">
                <div style="margin-bottom: 0.75rem; font-size: 0.8125rem; color: hsl(var(--muted-foreground)); font-weight: 500;">
                  Selecionar intervalo pr√©-definido:
                </div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                  <label class="form-radio">
                    <input type="radio" name="intervalo_preset" value="muito_curto" />
                    <span><strong>Muito curto:</strong> 1-5s</span>
                  </label>
                  <label class="form-radio">
                    <input type="radio" name="intervalo_preset" value="curto" />
                    <span><strong>Curto:</strong> 5-20s</span>
                  </label>
                  <label class="form-radio">
                    <input type="radio" name="intervalo_preset" value="medio" />
                    <span><strong>M√©dio:</strong> 20-50s</span>
                  </label>
                  <label class="form-radio">
                    <input type="radio" name="intervalo_preset" value="longo" />
                    <span><strong>Longo:</strong> 50-120s</span>
                  </label>
                  <label class="form-radio">
                    <input type="radio" name="intervalo_preset" value="muito_longo" />
                    <span><strong>Muito longo:</strong> 120-300s</span>
                  </label>
                  <label class="form-radio">
                    <input type="radio" name="intervalo_preset" value="padrao" checked />
                    <span><strong>Padr√£o (recomendado):</strong> 130-150s aleatorizado</span>
                  </label>
                  <label class="form-radio">
                    <input type="radio" name="intervalo_preset" value="personalizado" />
                    <span><strong>Personalizado:</strong> Digite valor abaixo</span>
                  </label>
                </div>
              </div>

              <!-- Campo num√©rico personalizado -->
              <div style="margin-top: 0.75rem;">
                <label style="display: block; margin-bottom: 0.375rem; font-size: 0.8125rem; color: hsl(var(--muted-foreground));">
                  Valor personalizado (segundos):
                </label>
                <input
                  type="number"
                  id="intervalo_envios_segundos"
                  class="form-input"
                  min="1"
                  max="300"
                  value="130"
                  placeholder="130 (padr√£o aleatorizado)"
                />
              </div>

              <small>
                Valor base com varia√ß√£o aleat√≥ria de ¬±10s por disparo (para n√£o parecer automa√ß√£o). 
                Selecione uma op√ß√£o acima ou digite um valor personalizado. Valor padr√£o (130) usa aleatoriza√ß√£o 130-150s.
              </small>
            </div>

            <div class="form-group">
              <label>Prioridade (1-10)</label>
              <input type="number" id="prioridade" class="form-input" value="5" min="1" max="10" />
              <small>
                Maior prioridade processada primeiro quando cliente eleg√≠vel
                para m√∫ltiplas campanhas
              </small>
            </div>
          </div>

          <div class="form-group">
            <label>Inst√¢ncia API WhatsApp <small>(obrigat√≥rio)</small></label>
            <select id="whatsapp_api_id" class="form-select" required>
              <option value="">Carregando inst√¢ncias...</option>
            </select>
            <small>
              Selecione qual inst√¢ncia de API WhatsApp usar para esta campanha.
              Configure inst√¢ncias em "‚öôÔ∏è Gerenciar Configura√ß√µes".
            </small>
          </div>

          <!-- Se√ß√£o de Estimativas de Tempo -->
          <div id="estimativas-tempo" class="form-section">
            <h4>üìä Estimativas de Tempo</h4>
            <div id="estimativas-conteudo">
              <p style="color: hsl(var(--muted-foreground)); font-size: 0.875rem; margin: 0;">
                Configure o limite di√°rio e intervalo para ver estimativas
              </p>
            </div>
          </div>

          <div class="form-group">
            <label id="label_prompt_ia">Prompt Personalizado para IA <span id="prompt_ia_required" style="color: hsl(var(--destructive));">*</span></label>
            <textarea
              id="prompt_ia"
              class="form-textarea"
              rows="4"
              placeholder="Instru√ß√µes espec√≠ficas para a IA gerar mensagens desta campanha..."
            ></textarea>
            <small id="prompt_ia_help">
              Obrigat√≥rio apenas se nenhum template de prompt for selecionado.
            </small>
          </div>

          <div class="form-group">
            <label>Template de Mensagem <small>(opcional)</small></label>
            <textarea
              id="template_mensagem"
              class="form-textarea"
              rows="3"
              placeholder="Template base opcional..."
            ></textarea>
          </div>

          <!-- Se√ß√£o: Configura√ß√µes de IA -->
          <div class="form-section" style="background: hsl(var(--primary) / 0.05); border-left: 4px solid hsl(var(--primary));">
            <h4 style="margin-top: 0; margin-bottom: 1rem;">
              ü§ñ Configura√ß√µes do Agente IA
            </h4>

            <div class="form-group">
              <label class="form-checkbox">
                <input
                  type="checkbox"
                  id="usar_veiculos"
                  checked
                />
                <span>Incluir informa√ß√µes de ve√≠culos no contexto da IA</span>
              </label>
              <small>
                Se marcado, a IA ter√° acesso aos dados de ve√≠culos do cliente.
                Desmarque para campanhas gen√©ricas (Natal, Ano Novo).
              </small>
            </div>

            <div class="form-group">
              <label class="form-checkbox">
                <input
                  type="checkbox"
                  id="usar_vendedor"
                />
                <span>Incluir nome do vendedor no contexto da IA</span>
              </label>
              <small>
                Se marcado, a IA poder√° mencionar o vendedor do ve√≠culo mais
                recente. √ötil para campanhas de relacionamento.
              </small>
            </div>

            <!-- Se√ß√£o: Dados Din√¢micos do Agente IA -->
            <div class="form-group" style="margin-top: 1.25rem;">
              <label class="form-checkbox">
                <input
                  type="checkbox"
                  id="usar_configuracoes_globais"
                  checked
                />
                <span>Usar configura√ß√µes globais da empresa</span>
              </label>
              <small>
                Se marcado, usa configura√ß√µes globais como base. Pode ser
                sobrescrito abaixo.
              </small>
            </div>

            <div class="form-group">
              <label>Template de Prompt <small>(opcional)</small></label>
              <select id="template_prompt_id" class="form-select">
                <option value="">Nenhum - usar prompt personalizado</option>
              </select>
              <small>
                Selecione um template para usar como base do prompt. O prompt
                personalizado ser√° ignorado se um template for selecionado.
              </small>
            </div>

            <div class="form-group">
              <label>Sess√µes de Contexto Habilitadas</label>
              <div
                id="sessoes_contexto_checkboxes"
                class="form-section"
                style="max-height: 200px; overflow-y: auto; padding: 1rem; margin-bottom: 0;"
              >
                <p style="color: hsl(var(--muted-foreground)); font-size: 0.875rem; margin: 0;">
                  Carregando sess√µes...
                </p>
              </div>
              <small>
                Selecione quais sess√µes de contexto incluir no prompt do agente
                IA.
              </small>
            </div>

            <details style="margin-top: 1rem; margin-bottom: 1rem;">
              <summary
                style="cursor: pointer; font-weight: 600; color: hsl(var(--primary)); padding: 0.5rem 0;"
              >
                Sobrescrever Configura√ß√µes Globais <small>(opcional)</small>
              </summary>
              <div
                id="configuracoes_sobrescritas"
                class="form-section"
                style="margin-top: 0.75rem; padding: 1rem;"
              >
                <p style="color: hsl(var(--muted-foreground)); font-size: 0.875rem; margin: 0;">
                  Carregando configura√ß√µes...
                </p>
              </div>
              <small>
                Deixe vazio para usar a configura√ß√£o global. Preencha para
                sobrescrever.
              </small>
            </details>
          </div>

          <!-- Se√ß√£o: Processamento em Lotes -->
          <div class="form-section" style="background: hsl(var(--warning) / 0.05); border-left: 4px solid hsl(var(--warning));">
            <h4 style="margin-top: 0; margin-bottom: 1rem;">
              ‚öôÔ∏è Processamento em Lotes e Hor√°rio
            </h4>

            <div class="form-row">
              <div class="form-group">
                <label>Tamanho do Lote</label>
                <input
                  type="number"
                  id="tamanho_lote"
                  class="form-input"
                  value="50"
                  min="10"
                  max="500"
                />
                <small>
                  N√∫mero de clientes processados por execu√ß√£o (padr√£o: 50,
                  m√≠nimo: 10, m√°ximo: 500)
                </small>
              </div>

              <div class="form-group">
                <label>Processar Finais de Semana</label>
                <label class="form-checkbox">
                  <input
                    type="checkbox"
                    id="processar_finais_semana"
                  />
                  <span>Processar tamb√©m s√°bados e domingos</span>
                </label>
                <small>
                  Se desmarcado, processa apenas dias √∫teis (segunda a sexta)
                </small>
              </div>
            </div>

            <!-- Se√ß√£o: Modo Teste e Debug -->
            <div class="form-section">
              <h3 style="margin-top: 0; margin-bottom: 1rem; font-size: 1rem;">
                üß™ Modo Teste e Debug
              </h3>

              <!-- Modo Teste -->
              <div class="form-group">
                <label class="form-checkbox">
                  <input
                    type="checkbox"
                    id="modo_teste"
                  />
                  <span>Modo Teste (substituir telefones dos clientes)</span>
                </label>
                <small>
                  Quando ativado, processa clientes normalmente mas envia
                  mensagens para os telefones de teste.
                </small>
              </div>

              <div
                class="form-group"
                id="telefones_teste_group"
                style="display: none"
              >
                <label for="telefones_teste">
                  Telefones de Teste
                  <small>(deixe vazio para usar configura√ß√£o global)</small>
                </label>
                <textarea
                  id="telefones_teste"
                  class="form-textarea"
                  rows="3"
                  placeholder="5511999999999&#10;5511988888888&#10;(um por linha)"
                  style="font-family: monospace;"
                ></textarea>
                <small>
                  Digite um telefone por linha no formato 55XXXXXXXXXXX (c√≥digo
                  pa√≠s + DDD + n√∫mero).
                </small>
                <div
                  id="telefones_teste_validacao"
                  class="validation-message"
                  style="
                    font-size: 0.85rem;
                    margin-top: 0.5rem;
                    padding: 0.5rem;
                    border-radius: 4px;
                  "
                ></div>
              </div>

              <!-- Modo Debug -->
              <div class="form-group">
                <label class="form-checkbox">
                  <input
                    type="checkbox"
                    id="modo_debug"
                  />
                  <span>Modo Debug (logs detalhados)</span>
                </label>
                <small>
                  Ativa logs detalhados no N8N para debug do fluxo de
                  processamento.
                </small>
              </div>
            </div>

            <!-- Se√ß√£o: Notifica√ß√µes Admin -->
            <div
              class="form-section"
              style="margin-top: 20px; margin-bottom: 20px"
            >
              <h3
                style="
                  margin-top: 0;
                  margin-bottom: 1rem;
                  color: #333;
                  font-size: 1.1rem;
                "
              >
                üîî Notifica√ß√µes Admin
              </h3>

              <div class="form-group">
                <label for="telefones_admin">
                  Telefones Admin
                  <span style="color: #999; font-size: 0.85rem"
                    >(deixe vazio para usar configura√ß√£o global)</span
                  >
                </label>
                <textarea
                  id="telefones_admin"
                  rows="2"
                  placeholder="5511999999999&#10;5511988888888"
                  style="
                    width: 100%;
                    padding: 8px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    font-family: monospace;
                  "
                ></textarea>
                <p
                  class="help-text"
                  style="
                    font-size: 0.85rem;
                    color: #666;
                    margin-top: 0.25rem;
                    margin-bottom: 0;
                  "
                >
                  Telefones que receber√£o notifica√ß√µes sobre a campanha (um por
                  linha).
                </p>
                <div
                  id="telefones_admin_validacao"
                  class="validation-message"
                  style="
                    font-size: 0.85rem;
                    margin-top: 0.5rem;
                    padding: 0.5rem;
                    border-radius: 4px;
                  "
                ></div>
              </div>

              <div class="form-group">
                <label
                  style="display: flex; align-items: center; cursor: pointer"
                >
                  <input
                    type="checkbox"
                    id="notificar_inicio"
                    style="width: auto; margin-right: 8px"
                  />
                  <span>Notificar ao iniciar campanha</span>
                </label>
              </div>

              <div class="form-group">
                <label
                  style="display: flex; align-items: center; cursor: pointer"
                >
                  <input
                    type="checkbox"
                    id="notificar_erros"
                    checked
                    style="width: auto; margin-right: 8px"
                  />
                  <span>Notificar erros cr√≠ticos</span>
                </label>
              </div>

              <div class="form-group">
                <label
                  style="display: flex; align-items: center; cursor: pointer"
                >
                  <input
                    type="checkbox"
                    id="notificar_conclusao"
                    checked
                    style="width: auto; margin-right: 8px"
                  />
                  <span>Notificar ao concluir campanha</span>
                </label>
              </div>

              <div class="form-group">
                <label
                  style="display: flex; align-items: center; cursor: pointer"
                >
                  <input
                    type="checkbox"
                    id="notificar_limite"
                    style="width: auto; margin-right: 8px"
                  />
                  <span>Notificar ao atingir limite di√°rio</span>
                </label>
              </div>

              <div class="form-group">
                <label for="whatsapp_api_id_admin">
                  Inst√¢ncia WhatsApp para Notifica√ß√µes
                  <span style="color: #999; font-size: 0.85rem"
                    >(deixe vazio para usar a mesma da campanha)</span
                  >
                </label>
                <select
                  id="whatsapp_api_id_admin"
                  style="
                    width: 100%;
                    padding: 8px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                  "
                >
                  <option value="">-- Usar inst√¢ncia da campanha --</option>
                </select>
                <p
                  class="help-text"
                  style="
                    font-size: 0.85rem;
                    color: #666;
                    margin-top: 0.25rem;
                    margin-bottom: 0;
                  "
                >
                  Escolha uma inst√¢ncia diferente para evitar sobrecarga na
                  inst√¢ncia principal da campanha. Recomendado: usar inst√¢ncia
                  dedicada para notifica√ß√µes admin.
                </p>
              </div>
            </div>

            <!-- Se√ß√£o: Configura√ß√£o por Dia da Semana -->
            <div
              style="
                background: #fff5f0;
                padding: 15px;
                border-radius: 6px;
                margin-top: 20px;
                margin-bottom: 20px;
                border-left: 4px solid #ff6b35;
              "
            >
              <h4 style="margin-top: 0; color: #333; margin-bottom: 15px">
                üìÖ Configura√ß√£o por Dia da Semana
              </h4>
              
              <div class="form-group" style="margin-bottom: 15px">
                <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 10px">
                  <input
                    type="radio"
                    name="modo_configuracao_dias"
                    id="modo_configuracao_padrao"
                    value="padrao"
                    checked
                    onchange="toggleConfiguracaoDiasSemana()"
                    style="width: auto; margin-right: 8px"
                  />
                  <span>Usar configura√ß√£o padr√£o (hor√°rio in√≠cio/fim e processar finais de semana)</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer">
                  <input
                    type="radio"
                    name="modo_configuracao_dias"
                    id="modo_configuracao_individual"
                    value="individual"
                    onchange="toggleConfiguracaoDiasSemana()"
                    style="width: auto; margin-right: 8px"
                  />
                  <span>Configurar cada dia individualmente</span>
                </label>
              </div>

              <!-- Campos padr√£o (sempre vis√≠veis) -->
              <div id="configuracao_padrao_dias">
                <div class="form-row">
                  <div class="form-group">
                    <label class="with-help">Hor√°rio In√≠cio <span class="help-icon" title="Hor√°rio em que a campanha come√ßa a processar automaticamente. O Schedule Trigger verifica este hor√°rio para iniciar a campanha.">?</span></label>
                    <input type="time" id="horario_inicio" value="09:00" />
                    <small style="color: #666">
                      Hor√°rio de in√≠cio para processamento autom√°tico (formato HH:MM). Define quando a campanha come√ßa a executar automaticamente.
                    </small>
                  </div>

                  <div class="form-group">
                    <label class="with-help">Hor√°rio Fim <span class="help-icon" title="Hor√°rio em que a campanha para de processar. Se definido, o sistema calcula automaticamente quantos clientes cabem neste hor√°rio.">?</span></label>
                    <input type="time" id="horario_fim" value="18:00" />
                    <small style="color: #666">
                      Hor√°rio de fim para processamento (formato HH:MM, opcional). Se definido, limita o processamento e calcula lotes automaticamente para caber no hor√°rio dispon√≠vel.
                    </small>
                  </div>
                </div>
              </div>

              <!-- Tabela de configura√ß√£o individual (inicialmente oculta) -->
              <div id="configuracao_individual_dias" style="display: none">
                <div style="margin-bottom: 10px">
                  <button
                    type="button"
                    onclick="aplicarHorarioPadrao()"
                    class="btn-secondary"
                    style="padding: 6px 12px; font-size: 13px"
                  >
                    üîÑ Aplicar hor√°rio padr√£o a todos os dias habilitados
                  </button>
                </div>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px">
                  <thead>
                    <tr style="background: #f5f5f5; border-bottom: 2px solid #ddd">
                      <th style="padding: 10px; text-align: left; width: 120px">Dia</th>
                      <th style="padding: 10px; text-align: center; width: 100px">Habilitado</th>
                      <th style="padding: 10px; text-align: left; width: 150px">Hor√°rio In√≠cio</th>
                      <th style="padding: 10px; text-align: left; width: 150px">Hor√°rio Fim</th>
                    </tr>
                  </thead>
                  <tbody id="tabela_dias_semana">
                    <!-- Preenchido via JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Se√ß√£o: Intervalo de Almo√ßo -->
            <div
              style="
                background: #fff5f0;
                padding: 15px;
                border-radius: 6px;
                margin-top: 20px;
                margin-bottom: 20px;
                border-left: 4px solid #ff6b35;
              "
            >
              <h4 style="margin-top: 0; color: #333; margin-bottom: 15px">
                üçΩÔ∏è Intervalo de Almo√ßo
              </h4>
              
              <div class="form-group" style="margin-bottom: 15px">
                <label style="display: flex; align-items: center; cursor: pointer">
                  <input
                    type="checkbox"
                    id="pausar_almoco"
                    onchange="toggleCamposAlmoco()"
                    style="width: auto; margin-right: 8px"
                  />
                  <span>Pausar durante hor√°rio de almo√ßo</span>
                </label>
                <small style="color: #666; display: block; margin-top: 5px">
                  Quando marcado, o sistema pausa automaticamente durante o intervalo de almo√ßo e separa os lotes antes e depois do almo√ßo.
                </small>
              </div>

              <div id="campos_almoco" style="display: none">
                <div class="form-row">
                  <div class="form-group">
                    <label>Hor√°rio In√≠cio Almo√ßo</label>
                    <input type="time" id="horario_almoco_inicio" value="12:00" />
                    <small style="color: #666">
                      Hor√°rio em que o intervalo de almo√ßo come√ßa (formato HH:MM)
                    </small>
                  </div>

                  <div class="form-group">
                    <label>Hor√°rio Fim Almo√ßo</label>
                    <input type="time" id="horario_almoco_fim" value="13:00" />
                    <small style="color: #666">
                      Hor√°rio em que o intervalo de almo√ßo termina (formato HH:MM)
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Painel de Estimativas -->
            <div
              id="painel_estimativas"
              style="
                background: #f0f9ff;
                padding: 20px;
                border-radius: 6px;
                margin-top: 20px;
                margin-bottom: 20px;
                border-left: 4px solid #3b82f6;
                display: none;
              "
            >
              <h4 style="margin-top: 0; color: #333; margin-bottom: 15px">
                üìä Estimativas da Campanha
              </h4>
              <div id="estimativas-conteudo">
                <!-- Preenchido via JavaScript -->
              </div>
              <div id="sugestoes-automaticas" style="margin-top: 15px">
                <!-- Preenchido via JavaScript -->
              </div>
            </div>

            <!-- Se√ß√£o: Lista de Clientes (Opcional) -->
            <div
              style="
                background: #f0f9ff;
                padding: 15px;
                border-radius: 6px;
                margin-top: 20px;
                margin-bottom: 20px;
                border-left: 4px solid #3b82f6;
              "
            >
              <h4 style="margin-top: 0; color: #333; margin-bottom: 15px">
                üìã Lista de Clientes (Opcional)
              </h4>
              <div class="form-group">
                <label>Usar Lista Global</label>
                <select id="listaIdCampanha" class="form-select" onchange="toggleSelecaoManualClientes()">
                  <option value="">Usar todos os eleg√≠veis</option>
                  <!-- Preenchido dinamicamente com listas globais -->
                </select>
                <small class="form-text text-muted">
                  Selecione uma lista global ou deixe vazio para usar todos os clientes eleg√≠veis.
                  Listas espec√≠ficas s√£o criadas automaticamente ao selecionar clientes manualmente.
                </small>
              </div>
            </div>

            <!-- Se√ß√£o: Sele√ß√£o de Clientes -->
            <div
              id="secaoSelecaoManualClientes"
              style="
                background: #f0f7ff;
                padding: 15px;
                border-radius: 6px;
                margin-top: 20px;
                margin-bottom: 20px;
                border-left: 4px solid #667eea;
              "
            >
              <h4 style="margin-top: 0; color: #333; margin-bottom: 15px">
                üë• Selecionar Clientes para Campanha
              </h4>
              <p style="color: #666; font-size: 14px; margin-bottom: 15px">
                Por padr√£o, a campanha enviar√° para todos os clientes eleg√≠veis.
                Selecione clientes espec√≠ficos abaixo para limitar o envio
                apenas a eles.
              </p>

              <div
                style="
                  display: flex;
                  gap: 10px;
                  margin-bottom: 15px;
                  flex-wrap: wrap;
                "
              >
                <button
                  type="button"
                  onclick="selecionarTodosClientes()"
                  class="btn-secondary"
                  style="padding: 8px 16px"
                >
                  ‚úÖ Selecionar Todos
                </button>
                <button
                  type="button"
                  onclick="desmarcarTodosClientes()"
                  class="btn-secondary"
                  style="padding: 8px 16px"
                >
                  ‚ùå Desmarcar Todos
                </button>
                <button
                  type="button"
                  onclick="inverterSelecaoClientes()"
                  class="btn-secondary"
                  style="padding: 8px 16px"
                >
                  üîÑ Inverter Sele√ß√£o
                </button>
              </div>

              <div style="margin-bottom: 10px">
                <input
                  type="text"
                  id="buscaClientesSelecao"
                  placeholder="Buscar cliente por nome ou telefone..."
                  style="
                    width: 100%;
                    padding: 8px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                  "
                  onkeyup="filtrarClientesSelecao()"
                />
              </div>

              <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                <select
                  id="ordenacaoCampoSelecao"
                  style="flex: 1; min-width: 150px"
                  onchange="renderizarListaClientesSelecao()"
                >
                  <option value="nome_cliente" selected>Nome (A-Z)</option>
                  <option value="ultimo_envio">√öltimo Envio</option>
                  <option value="status_whatsapp">Status WhatsApp</option>
                  <option value="bloqueado_envios">Status Bloqueio</option>
                </select>
                <select
                  id="ordenacaoDirecaoSelecao"
                  style="width: 120px"
                  onchange="renderizarListaClientesSelecao()"
                >
                  <option value="asc" selected>Crescente ‚Üë</option>
                  <option value="desc">Decrescente ‚Üì</option>
                </select>
              </div>

              <div style="margin-bottom: 10px; padding: 10px; background: #f9fafb; border-radius: 4px; border: 1px solid #e5e7eb;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input
                    type="checkbox"
                    id="filtroApenasNaoEnviados"
                    onchange="renderizarListaClientesSelecao()"
                    style="width: 18px; height: 18px; cursor: pointer;"
                  />
                  <span style="font-size: 14px; color: #333;">
                    üìã Mostrar apenas clientes que ainda <strong>n√£o receberam</strong> mensagens nesta campanha
                  </span>
                </label>
                <small style="display: block; color: #666; margin-top: 5px; margin-left: 26px; font-size: 12px;">
                  Clientes que j√° receberam mensagens ser√£o marcados automaticamente com um indicador visual (badge "üì® J√° enviado" e fundo azul). 
                  <strong>O sistema sempre valida no backend antes de enviar</strong>, ent√£o mesmo que voc√™ selecione manualmente um cliente j√° enviado, ele ser√° pulado automaticamente durante a execu√ß√£o.
                </small>
                <div id="contadorClientesJaEnviados" style="display: none; margin-top: 8px; margin-left: 26px; padding: 6px 10px; background: #e3f2fd; border-radius: 4px; font-size: 12px; color: #1976d2;">
                  <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> <span id="textoContadorJaEnviados"></span>
                </div>
              </div>

              <div style="margin-bottom: 10px">
                <strong id="contadorClientesSelecionados"
                  >0 clientes selecionados</strong
                >
              </div>

              <div
                id="listaClientesSelecao"
                style="
                  max-height: 300px;
                  overflow-y: auto;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                  padding: 10px;
                  background: white;
                "
              >
                <p style="text-align: center; color: #666; padding: 20px">
                  Carregando clientes...
                </p>
              </div>

              <small style="color: #666; display: block; margin-top: 10px">
                Apenas clientes com WhatsApp validado s√£o exibidos (ativo, n√£o
                bloqueado, status_whatsapp = 'valid'). Para verificar o WhatsApp
                de um cliente, use o bot√£o "‚úÖ Verificar WhatsApp" na lista de
                clientes. Se nenhum cliente for selecionado, a campanha enviar√°
                para todos os eleg√≠veis.
              </small>
            </div>

            <!-- Se√ß√£o: Quantidade de Clientes (Opcional) -->
            <div
              style="
                background: #f0f7ff;
                padding: 15px;
                border-radius: 6px;
                margin-top: 20px;
                margin-bottom: 20px;
                border-left: 4px solid #667eea;
              "
            >
              <h4 style="margin-top: 0; color: #333; margin-bottom: 15px">
                üìä Quantidade de Clientes (Opcional)
              </h4>
              <div class="form-group">
                <label>Quantidade Fixa de Clientes</label>
                <input
                  type="number"
                  id="quantidade_clientes"
                  min="1"
                  placeholder="Deixe vazio para usar clientes selecionados ou todos eleg√≠veis"
                />
                <small style="color: #666">
                  Se preenchido, ser√° usado para c√°lculos de estimativas. Se vazio, usa quantidade de clientes selecionados ou todos eleg√≠veis do banco.
                </small>
              </div>
            </div>

            <div
              id="estimativas-lote"
              style="
                background: #f5f5f5;
                padding: 10px;
                border-radius: 4px;
                margin-top: 10px;
              "
            >
              <p style="color: #666; font-size: 13px; margin: 0">
                <strong>Estimativa:</strong>
                <span id="estimativa-dias-lote"
                  >Configure o tamanho do lote e limite di√°rio para ver
                  estimativa</span
                >
              </p>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="fecharModal()">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              Salvar Campanha
            </button>
          </div>
        </form>
      </div>
    </div>
    </div>

    <!-- Modal Criar/Editar Lista -->
    <div id="modalCriarEditarLista" class="modal" style="display: none;">
      <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
          <h2 id="modalListaTitle">Nova Lista de Clientes</h2>
          <button onclick="document.getElementById('modalCriarEditarLista').style.display='none'" class="modal-close">‚úï</button>
        </div>
        <div class="modal-body">
          <!-- Tabs -->
          <div class="modal-tabs">
            <button class="modal-tab active" id="tabGeral" onclick="mudarAbaLista('geral')">Geral</button>
            <button class="modal-tab" id="tabFiltros" onclick="mudarAbaLista('filtros')">Filtros e Sele√ß√£o</button>
            <button class="modal-tab" id="tabLotes" onclick="mudarAbaLista('lotes')">Lotes</button>
            <button class="modal-tab" id="tabAgendamento" onclick="mudarAbaLista('agendamento')">Agendamento</button>
          </div>

          <!-- Aba Geral -->
          <div id="abaGeral" class="modal-tab-content active">
            <div class="form-group">
              <label>Nome da Lista *</label>
              <input type="text" id="listaNome" class="form-input" placeholder="Ex: Clientes VIP, Inativos h√° 30 dias" required>
            </div>
            <div class="form-group">
              <label>Descri√ß√£o</label>
              <textarea id="listaDescricao" class="form-input" rows="3" placeholder="Descri√ß√£o opcional da lista"></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Tipo de Lista *</label>
                <select id="listaTipo" class="form-select" onchange="atualizarVisibilidadeCamposLista(this.value)" required>
                  <option value="estatica">Est√°tica (Sele√ß√£o Manual)</option>
                  <option value="dinamica">Din√¢mica (Filtros)</option>
                  <option value="baseada_campanha">Baseada em Campanha</option>
                </select>
              </div>
              <div class="form-group">
                <label>Escopo *</label>
                <select id="listaEscopo" class="form-select" onchange="atualizarVisibilidadeEscopo(this.value)" required>
                  <option value="global">Global (Reutiliz√°vel)</option>
                  <option value="especifica">Espec√≠fica (Vinculada a Campanha)</option>
                </select>
              </div>
            </div>
            <div class="form-group" id="campanhaIdSection" style="display: none;">
              <label>Campanha (Obrigat√≥ria para Escopo Espec√≠fica)</label>
              <select id="listaCampanhaId" class="form-select">
                <option value="">Selecione uma campanha</option>
                <!-- Preenchido dinamicamente -->
              </select>
            </div>
            <div class="form-group" id="campanhaBaseSection" style="display: none;">
              <label>Campanha Base *</label>
              <select id="listaCampanhaBaseId" class="form-select" required>
                <option value="">Selecione uma campanha</option>
                <!-- Preenchido dinamicamente -->
              </select>
              <small class="form-text text-muted">Campanha de refer√™ncia para filtrar clientes</small>
            </div>
            <div class="form-group" id="criterioCampanhaBaseSection" style="display: none;">
              <label>Crit√©rio *</label>
              <select id="listaCriterioCampanhaBase" class="form-select" required>
                <option value="nao_receberam">N√£o receberam mensagem desta campanha</option>
                <option value="receberam">Receberam mensagem desta campanha</option>
                <option value="status_envio">Por status de envio</option>
                <option value="data_envio">Por data de envio</option>
              </select>
              <small class="form-text text-muted">Crit√©rio para filtrar clientes baseado na campanha selecionada</small>
            </div>
            <div class="form-group">
              <label>Limite de Envios por Dia</label>
              <input type="number" id="listaLimiteEnviosDia" class="form-input" value="200" min="1" max="1000">
              <small class="form-text text-muted">M√°ximo de mensagens que podem ser enviadas por dia usando esta lista</small>
            </div>
          </div>

          <!-- Aba Filtros e Sele√ß√£o (combinada) -->
          <div id="abaFiltros" class="modal-tab-content" style="display: none;">
            <!-- Se√ß√£o de Filtros (para listas din√¢micas) -->
            <div id="secaoFiltrosDinamicos" style="display: none;">
              <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; color: #1f2937;">Filtros Din√¢micos</h3>
              <div class="form-group">
                <label>Operador L√≥gico</label>
                <select id="filtroOperadorLogico" class="form-select">
                  <option value="AND">E (AND) - Todas as condi√ß√µes devem ser verdadeiras</option>
                  <option value="OR">OU (OR) - Pelo menos uma condi√ß√£o deve ser verdadeira</option>
                </select>
              </div>
              <div id="filtrosDinamicosContainer">
                <!-- Filtros ser√£o adicionados aqui dinamicamente -->
              </div>
              <button type="button" onclick="adicionarFiltroCondicao()" class="btn btn-secondary">+ Adicionar Condi√ß√£o</button>
              <div style="margin-top: 20px;">
                <button type="button" onclick="testarFiltros()" class="btn btn-primary">Testar Filtros</button>
                <div id="resultadoTesteFiltros" style="margin-top: 10px;"></div>
              </div>
            </div>

            <!-- Se√ß√£o de Sele√ß√£o Manual (para listas est√°ticas ou ajuste manual) -->
            <div id="secaoSelecaoManual" style="margin-top: 30px;">
              <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; color: #1f2937;">Sele√ß√£o de Clientes</h3>
              <p style="color: #6b7280; margin-bottom: 15px;">
                Selecione os clientes que far√£o parte desta lista. Apenas clientes eleg√≠veis (ativos, n√£o bloqueados, com WhatsApp v√°lido) s√£o mostrados.
              </p>
              <div id="infoFiltrosAtivos" style="display: none; margin-top: 10px; margin-bottom: 15px; padding: 10px; background: #eff6ff; border-left: 4px solid #3b82f6; border-radius: 4px;">
                <strong>üîç Filtros Ativos:</strong> <span id="textoFiltrosAtivos"></span><br>
                <span id="totalFiltrados"></span> clientes atendem aos crit√©rios. Clientes filtrados j√° est√£o pr√©-selecionados.
              </div>
              <div id="clientesListaContainer" class="loading">
                <p>Carregando clientes...</p>
              </div>
            </div>
          </div>

          <!-- Aba Lotes -->
          <div id="abaLotes" class="modal-tab-content" style="display: none;">
            <p style="color: #6b7280; margin-bottom: 15px;">
              Divida esta lista em lotes menores para processamento escalonado.
            </p>
            <div id="lotesListaContainer">
              <p>Lotes ser√£o exibidos aqui ap√≥s a lista ser salva.</p>
            </div>
            <button type="button" onclick="gerarLotesAutomaticos()" class="btn btn-primary" style="margin-top: 15px;">Gerar Lotes Automaticamente</button>
          </div>

          <!-- Aba Agendamento -->
          <div id="abaAgendamento" class="modal-tab-content" style="display: none;">
            <div class="form-group">
              <label>
                <input type="checkbox" id="agendamentoAtivo" onchange="toggleAgendamento()">
                Ativar Agendamento Autom√°tico
              </label>
            </div>
            <div id="camposAgendamento" style="display: none;">
              <div class="form-group">
                <label>Express√£o Cron *</label>
                <input type="text" id="agendamentoCron" class="form-input" placeholder="Ex: 0 9 * * 1-5 (9h, dias √∫teis)">
                <small class="form-text text-muted">
                  Formato: minuto hora dia_m√™s m√™s dia_semana<br>
                  Exemplos: "0 9 * * 1-5" (9h, dias √∫teis), "30 14 * * *" (14:30, todos os dias)
                </small>
              </div>
              <div id="proximasExecucoes" style="margin-top: 15px;">
                <!-- Pr√≥ximas execu√ß√µes ser√£o exibidas aqui -->
              </div>
              <div id="conflitosAgendamento" style="margin-top: 15px;">
                <!-- Conflitos ser√£o exibidos aqui -->
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="document.getElementById('modalCriarEditarLista').style.display='none'">Cancelar</button>
            <button type="button" onclick="salvarLista()" class="btn btn-primary">Salvar Lista</button>
          </div>
        </div>
      </div>
    </div>

    <script src="app.js"></script>
    <script src="router.js"></script>
    <script src="dashboard.js"></script>
    <script src="notifications.js"></script>
    <script src="relatorios.js"></script>
    <script src="filters.js"></script>
  </body>
</html>
